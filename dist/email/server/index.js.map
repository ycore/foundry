{"version":3,"file":"index.js","sources":["../../../src/email/email.context.ts","../../../src/email/server/email.middleware.ts","../../../src/email/email.config.ts","../../../src/email/providers/base-provider.ts","../../../src/email/providers/local-dev.ts","../../../src/email/providers/mailchannels.ts","../../../src/email/providers/resend.ts","../../../src/email/providers/test-mock.ts","../../../src/email/email-provider.ts","../../../src/email/server/email.service.ts","../../../src/email/server/render-email.ts"],"sourcesContent":["import { createContext } from 'react-router';\nimport type { EmailConfig } from './@types/email.types';\n\nexport const emailContext = createContext<EmailConfig | null>(null);\n","import { setContext } from '@ycore/forge/context';\nimport type { MiddlewareFunction } from 'react-router';\nimport type { EmailConfig } from '../@types/email.types';\nimport { emailContext } from '../email.context';\n\n/**\n * Email configuration middleware\n *\n * Injects email configuration into React Router context for use by email services.\n * This eliminates prop-drilling of email config through function parameters.\n */\nexport function emailConfigMiddleware(emailConfig: EmailConfig): MiddlewareFunction<Response> {\n  return async ({ context }, next) => {\n    setContext(context, emailContext, emailConfig);\n    return next();\n  };\n}\n","import type { EmailConfig } from './@types/email.types';\n\n/**\n * Default Email Configuration\n *\n * IMPORTANT: This configuration uses local-dev provider by default for development.\n * For production deployments, you MUST:\n * 1. Override this config in your app's config file (e.g., app/config/config.system.ts)\n * 2. Set active provider to 'resend' or 'mailchannels'\n * 3. Configure valid sendFrom addresses for your domain\n * 4. Set API keys via environment variables or Cloudflare bindings\n *\n */\nexport const defaultEmailConfig: EmailConfig = {\n  active: 'local-dev',\n  providers: [\n    {\n      name: 'local-dev',\n      sendFrom: 'dev@localhost',\n    },\n  ],\n};\n","import { logger } from '@ycore/forge/logger';\nimport type { Result } from '@ycore/forge/result';\nimport { err, tryCatch } from '@ycore/forge/result';\nimport type { EmailProvider, SendEmailOptions } from '../@types/email.types';\n\n/**\n * Configuration delays for email providers (in milliseconds)\n */\nexport const EMAIL_PROVIDER_DELAYS = {\n  LOCAL_DEV: 800,\n  TEST_MOCK: 10,\n} as const;\n\n/**\n * Base email provider factory - creates an EmailProvider with common validation and error handling logic\n */\nexport function createEmailProviderBase(name: string, sendFn: (options: SendEmailOptions) => Promise<void>): EmailProvider {\n  return {\n    async sendEmail(options: SendEmailOptions): Promise<Result<void>> {\n      const { from, to, template } = options;\n\n      if (!from) {\n        return err('From address is required');\n      }\n\n      return tryCatch(async () => {\n        await sendFn(options);\n\n        logger.debug('email_sent_success', {\n          provider: name,\n          to,\n          subject: template.subject,\n        });\n      }, `Failed to send email via ${name}`);\n    },\n  };\n}\n","import { logger } from '@ycore/forge/logger';\nimport type { EmailProvider } from '../@types/email.types';\nimport { createEmailProviderBase, EMAIL_PROVIDER_DELAYS } from './base-provider';\n\n/**\n * Local Dev Email Provider - Development provider that logs emails instead of sending\n */\nexport function createLocalDevEmailProvider(): EmailProvider {\n  return createEmailProviderBase('local-dev', async options => {\n    const { to, from, template } = options;\n    // Simulate a slight delay like a real email service\n    await new Promise(resolve => setTimeout(resolve, EMAIL_PROVIDER_DELAYS.LOCAL_DEV));\n    // Log email metadata using structured logging\n    logger.info('local_dev_email_sent', { provider: 'local-dev', from, to, subject: template.subject });\n    // Display email content with proper line breaks (console.log for readability in dev)\n    console.log(' === Message content (plain text)', '='.repeat(48), '\\n', template.text, '\\n', '='.repeat(80));\n  });\n}\n","import type { EmailProvider } from '../@types/email.types';\nimport { createEmailProviderBase } from './base-provider';\n\n/**\n * MailChannels Email Provider\n * Implementation for MailChannels email service\n *\n * Requires DNS record for authorization:\n * Type: TXT, Name: _mailchannels, Content: \"v=mc1 auth=<AccountId>\"\n */\nexport function createMailChannelsEmailProvider(): EmailProvider {\n  const apiUrl = 'https://api.mailchannels.net/tx/v1/send';\n\n  return createEmailProviderBase('mailchannels', async options => {\n    const { apiKey, to, from, template } = options;\n\n    const payload = {\n      personalizations: [\n        {\n          to: [{ email: to }],\n        },\n      ],\n      from: { email: from },\n      subject: template.subject,\n      content: [\n        { type: 'text/plain', value: template.text },\n        { type: 'text/html', value: template.html },\n      ],\n    };\n\n    const response = await fetch(apiUrl, {\n      method: 'POST',\n      headers: {\n        'X-Api-Key': apiKey,\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n      },\n      body: JSON.stringify(payload),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`MailChannels API error (${response.status}): ${errorText}`);\n    }\n  });\n}\n","import type { EmailProvider } from '../@types/email.types';\nimport { createEmailProviderBase } from './base-provider';\n\n/**\n * Resend Email Provider\n * Implementation for Resend email service (https://resend.com)\n */\nexport function createResendEmailProvider(): EmailProvider {\n  return createEmailProviderBase('resend', async options => {\n    const { apiKey, to, from, template } = options;\n\n    const response = await fetch('https://api.resend.com/emails', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${apiKey}`,\n      },\n      body: JSON.stringify({\n        from,\n        to,\n        subject: template.subject,\n        html: template.html,\n        text: template.text,\n      }),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`Resend API error (${response.status}): ${errorText}`);\n    }\n  });\n}\n","import { logger } from '@ycore/forge/logger';\nimport { err } from '@ycore/forge/result';\nimport type { EmailProvider } from '../@types/email.types';\nimport { createEmailProviderBase, EMAIL_PROVIDER_DELAYS } from './base-provider';\n\n/**\n * Stored email metadata for test verification (excludes sensitive data)\n */\nexport interface StoredTestEmail {\n  to: string;\n  from: string;\n  template: {\n    subject: string;\n    html: string;\n    text: string;\n  };\n}\n\n/**\n * Module-level state for test email tracking\n * Isolated from production code for security\n */\nlet sentEmails: StoredTestEmail[] = [];\nlet shouldFail = false;\nlet failureReason = 'Simulated email failure';\n\n/**\n * Test Mock Email Provider\n * Enhanced mock provider for testing that tracks sent emails and allows failure simulation\n */\nexport function createTestMockEmailProvider(): EmailProvider {\n  return {\n    async sendEmail(options) {\n      const { to, from, template } = options;\n\n      if (!from) {\n        return err('From address is required');\n      }\n\n      // Store email metadata for test verification (excludes sensitive apiKey)\n      sentEmails.push({\n        to,\n        from,\n        template: {\n          subject: template.subject,\n          html: template.html,\n          text: template.text,\n        },\n      });\n\n      // Simulate failure if configured\n      if (shouldFail) {\n        return err(failureReason);\n      }\n\n      // Use base provider for consistent behavior\n      const baseProvider = createEmailProviderBase('test-mock', async opts => {\n        await new Promise(resolve => setTimeout(resolve, EMAIL_PROVIDER_DELAYS.TEST_MOCK));\n\n        logger.debug('email_test_mock_sent', {\n          provider: 'test-mock',\n          from: opts.from,\n          to: opts.to,\n          subject: opts.template.subject,\n          textLength: opts.template.text.length,\n          htmlLength: opts.template.html.length,\n        });\n      });\n\n      return baseProvider.sendEmail(options);\n    },\n  };\n}\n\n// ============================================================================\n// Test Utility Functions\n// ============================================================================\n\n/**\n * Get all sent emails (returns copy to prevent mutation)\n */\nexport function getTestSentEmails(): StoredTestEmail[] {\n  return sentEmails.map(email => ({\n    to: email.to,\n    from: email.from,\n    template: {\n      subject: email.template.subject,\n      html: email.template.html,\n      text: email.template.text,\n    },\n  }));\n}\n\n/**\n * Get the most recently sent email\n */\nexport function getTestLastSentEmail(): StoredTestEmail | undefined {\n  const lastEmail = sentEmails[sentEmails.length - 1];\n  if (!lastEmail) {\n    return undefined;\n  }\n\n  return {\n    to: lastEmail.to,\n    from: lastEmail.from,\n    template: {\n      subject: lastEmail.template.subject,\n      html: lastEmail.template.html,\n      text: lastEmail.template.text,\n    },\n  };\n}\n\n/**\n * Get count of sent emails\n */\nexport function getTestEmailCount(): number {\n  return sentEmails.length;\n}\n\n/**\n * Find email sent to specific recipient\n */\nexport function findTestEmailByTo(to: string): StoredTestEmail | undefined {\n  return sentEmails.find(email => email.to === to);\n}\n\n/**\n * Find all emails with subject containing search string\n */\nexport function findTestEmailsBySubject(subject: string): StoredTestEmail[] {\n  return sentEmails.filter(email => email.template.subject.includes(subject));\n}\n\n/**\n * Clear all sent emails\n */\nexport function clearTestSentEmails(): void {\n  sentEmails = [];\n}\n\n/**\n * Configure provider to simulate failures\n */\nexport function simulateTestEmailFailure(reason = 'Simulated email failure'): void {\n  shouldFail = true;\n  failureReason = reason;\n}\n\n/**\n * Reset provider to success mode\n */\nexport function resetTestEmailToSuccess(): void {\n  shouldFail = false;\n  failureReason = 'Simulated email failure';\n}\n\n/**\n * Full reset - clears emails and resets failure state\n */\nexport function resetTestEmailProvider(): void {\n  clearTestSentEmails();\n  resetTestEmailToSuccess();\n}\n\n/**\n * Get current failure configuration\n */\nexport function getTestEmailFailureState(): { shouldFail: boolean; reason: string } {\n  return {\n    shouldFail,\n    reason: failureReason,\n  };\n}\n\n// ============================================================================\n// Test Assertion Helpers\n// ============================================================================\n\n/**\n * Assert that an email was sent to a specific recipient\n * Throws if email not found\n */\nexport function assertTestEmailSent(to: string): StoredTestEmail {\n  const email = findTestEmailByTo(to);\n  if (!email) {\n    throw new Error(`Expected email to be sent to ${to}, but no email was found`);\n  }\n  return email;\n}\n\n/**\n * Assert specific number of emails were sent\n */\nexport function assertTestEmailCount(expectedCount: number): void {\n  const actualCount = getTestEmailCount();\n  if (actualCount !== expectedCount) {\n    throw new Error(`Expected ${expectedCount} emails to be sent, but ${actualCount} were sent`);\n  }\n}\n\n/**\n * Assert no emails were sent\n */\nexport function assertTestNoEmailsSent(): void {\n  assertTestEmailCount(0);\n}\n","import type { Result } from '@ycore/forge/result';\nimport { err, ok } from '@ycore/forge/result';\nimport type { EmailConfig, EmailProvider, EmailProviderConfig, EmailProviders } from './@types/email.types';\nimport { createLocalDevEmailProvider } from './providers/local-dev';\nimport { createMailChannelsEmailProvider } from './providers/mailchannels';\nimport { createResendEmailProvider } from './providers/resend';\nimport { createTestMockEmailProvider } from './providers/test-mock';\n\nconst providerRegistry: Record<EmailProviders, () => EmailProvider> = {\n  'local-dev': createLocalDevEmailProvider,\n  mailchannels: createMailChannelsEmailProvider,\n  resend: createResendEmailProvider,\n  'test-mock': createTestMockEmailProvider,\n};\n\nexport function createEmailProvider(providerName: string): Result<EmailProvider> {\n  if (!isValidProvider(providerName)) {\n    return err(`Unsupported email provider: ${providerName}`);\n  }\n\n  try {\n    const factory = providerRegistry[providerName];\n    const provider = factory();\n    return ok(provider);\n  } catch (error) {\n    return err(`Failed to create email provider: ${providerName}`, undefined, { cause: error });\n  }\n}\n\nexport function isValidProvider(providerName: string): providerName is EmailProviders {\n  return providerName in providerRegistry;\n}\n\nexport function getSupportedProviders(): EmailProviders[] {\n  return Object.keys(providerRegistry) as EmailProviders[];\n}\n\nexport function getEmailProviderNames(emailConfig: EmailConfig): EmailProviders[] {\n  return emailConfig.providers.map(provider => provider.name);\n}\n\nexport function getProviderConfig(emailConfig: EmailConfig, providerName: string): EmailProviderConfig | undefined {\n  return emailConfig.providers.find(provider => provider.name === providerName);\n}\n","import { getContext } from '@ycore/forge/context';\nimport { logger } from '@ycore/forge/logger';\nimport { err, flattenError, isError, ok, type Result } from '@ycore/forge/result';\nimport { getBindings } from '@ycore/forge/services';\nimport type { RouterContextProvider } from 'react-router';\nimport type { EmailProviderConfig, SendMailOptions } from '../@types/email.types';\nimport { defaultEmailConfig } from '../email.config';\nimport { emailContext } from '../email.context';\nimport { createEmailProvider, getProviderConfig } from '../email-provider';\n\n/**\n * Send email with cascading configuration fallback\n *\n * This is the primary email sending function for the application.\n * It implements a predictable configuration cascade:\n * 1. Provided options (highest priority)\n * 2. Email context from middleware\n * 3. Default email config (lowest priority)\n */\nexport async function sendMail(context: Readonly<RouterContextProvider>, options: SendMailOptions): Promise<Result<void>> {\n  try {\n    const { to, template, from: optionsFrom, provider: optionsProvider, apiKey: optionsApiKey } = options;\n\n    // Get email config from context (may be null if middleware not configured)\n    const emailConfig = getContext(context, emailContext, null);\n    const provider = optionsProvider || emailConfig?.active || defaultEmailConfig.active;\n\n    if (!provider) {\n      logger.error('email_no_provider', { optionsProvider, contextActive: emailConfig?.active, defaultActive: defaultEmailConfig.active, to });\n      return err('No email provider configured');\n    }\n\n    // Get provider config with cascading fallback\n    const providerConfig = (emailConfig && getProviderConfig(emailConfig, provider)) || getProviderConfig(defaultEmailConfig, provider);\n    if (!providerConfig) {\n      logger.error('email_provider_config_missing', { provider, to, contextProviders: emailConfig?.providers.map((p: EmailProviderConfig) => p.name) });\n      return err(`Provider configuration not found for: ${provider}`);\n    }\n\n    // Determine apiKey with cascading fallback\n    let apiKey = optionsApiKey;\n    if (!apiKey && providerConfig.apiKey) {\n      const bindings = getBindings(context);\n      apiKey = bindings[providerConfig.apiKey as keyof typeof bindings] as string | undefined;\n    }\n\n    // Determine from address with cascading fallback\n    const from = optionsFrom || providerConfig.sendFrom;\n\n    // Create email provider instance\n    const emailProviderResult = createEmailProvider(provider);\n    if (isError(emailProviderResult)) {\n      logger.error('email_provider_creation_failed', { provider, to, error: flattenError(emailProviderResult) });\n      return emailProviderResult;\n    }\n\n    // Send email\n    const sendResult = await emailProviderResult.sendEmail({\n      apiKey: apiKey || '',\n      to,\n      from,\n      template: {\n        subject: template.subject,\n        text: template.text,\n        html: template.html,\n      },\n    });\n\n    if (isError(sendResult)) {\n      logger.error('email_send_failed', { to, from, provider, error: flattenError(sendResult) });\n      return sendResult;\n    }\n\n    return ok(undefined);\n  } catch (error) {\n    logger.error('email_send_unexpected_error', { to: options.to, error: error });\n    return err('Failed to send email', { error });\n  }\n}\n","/**\n * Email Template Renderer\n *\n * This file provides the rendering interface for email templates\n * using the new custom email components system.\n */\n\nimport { type EmailRenderOptions, type EmailTemplatePropsWithSubject as NewEmailTemplatePropsWithSubject, renderEmail } from '@ycore/componentry/email/server';\nimport type { EmailTemplate } from '../@types/email.types';\nimport type { EmailTemplateObject } from '../@types/email-template-builder';\n\n/**\n * Generic email template renderer - handles rendering React email templates to HTML and plaintext\n *\n * Accepts EmailTemplateObject created by defineEmailTemplate() and renders it with the provided data.\n * Automatically extracts subject from the template definition and applies Tailwind styles map.\n *\n * @example\n * ```typescript\n * const email = await renderEmailTemplate(ContactEmailTemplate, {\n *   name: 'John Doe',\n *   email: 'john@example.com',\n *   message: 'Hello!',\n *   origin: 'https://example.com',\n * });\n * ```\n */\nexport async function renderEmailTemplate<TData>(template: EmailTemplateObject<TData>, data: TData, options?: EmailRenderOptions): Promise<EmailTemplate> {\n  // Use the new renderEmail function from custom components\n  const result = await renderEmail(\n    template.component,\n    {\n      ...data,\n      subject: template.subject,\n    } as NewEmailTemplatePropsWithSubject<TData>,\n    {\n      ...options,\n      tailwindStylesMap: template.stylesMap ?? options?.tailwindStylesMap,\n    }\n  );\n\n  return {\n    subject: result.subject || '',\n    html: result.html,\n    text: result.text,\n  };\n}\n"],"names":[],"mappings":"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"}