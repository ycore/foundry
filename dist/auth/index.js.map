{"version":3,"file":"index.js","sources":["../../src/auth/auth.config.ts","../../../../node_modules/.bun/clsx@2.1.1/node_modules/clsx/dist/clsx.mjs","../../src/auth/server/webauthn-credential.ts","../../src/auth/components/webauthn-client.ts","../../src/auth/components/profile-page.tsx","../../src/auth/components/recover-page.tsx","../../src/auth/auth.constants.ts","../../src/auth/server/webauthn.ts","../../src/auth/components/signin-page.tsx","../../src/auth/components/signup-page.tsx","../../src/auth/components/verify-form.tsx","../../src/email/@types/email-template-builder.ts","../../src/auth/templates/tailwind.styles.ts","../../src/auth/templates/auth-totp.tsx","../../src/auth/templates/email-change-notification.tsx","../../src/auth/templates/email-change-verification.tsx","../../src/auth/templates/recovery-verification.tsx"],"sourcesContent":["import type { AuthConfig, AuthRoutes } from './@types/auth.config.types';\n\nexport const defaultAuthRoutes: AuthRoutes = {\n  signup: '/auth/signup',\n  signin: '/auth/signin',\n  signout: '/auth/signout',\n  signedin: '/',\n  signedout: '/',\n  recover: '/auth/recover',\n  verify: '/auth/verify',\n  profile: '/auth/profile',\n};\n\nexport const defaultAuthConfig: AuthConfig = {\n  routes: defaultAuthRoutes,\n  session: {\n    kvBinding: 'UNCONFIGURED',\n    secretKey: 'UNCONFIGURED',\n    cookie: {\n      name: '__auth_session',\n      httpOnly: true,\n      maxAge: 60 * 60 * 24 * 30,\n      path: '/',\n      sameSite: 'lax',\n      secure: 'auto', // Will be determined by environment\n    },\n  },\n  webauthn: {\n    rpName: 'React Router Cloudflare App',\n    challengeSessionKey: 'challenge',\n    requireUserVerification: true, // More secure\n  },\n  verification: {\n    digits: 6,\n    period: 60 * 8, // 8 minutes in seconds\n    maxAttempts: 3,\n    window: 1, // ±30 seconds\n    resendCooldown: 60, // seconds\n  },\n};\n","function r(e){var t,f,n=\"\";if(\"string\"==typeof e||\"number\"==typeof e)n+=e;else if(\"object\"==typeof e)if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(f=r(e[t]))&&(n&&(n+=\" \"),n+=f)}else for(f in e)e[f]&&(n&&(n+=\" \"),n+=f);return n}export function clsx(){for(var e,t,f=0,n=\"\",o=arguments.length;f<o;f++)(e=arguments[f])&&(t=r(e))&&(n&&(n+=\" \"),n+=t);return n}export default clsx;","import { decodeBase64url } from '@oslojs/encoding';\n\n/**\n * Helper function to convert serialized ArrayBuffer back to ArrayBuffer\n *\n * Handles multiple input formats:\n * - Native ArrayBuffer (passthrough)\n * - Serialized object format: {\"0\": byte, \"1\": byte, ...}\n * - Base64url encoded string\n */\nexport function arrayBufferFromObject(obj: any): ArrayBuffer {\n  if (obj instanceof ArrayBuffer) {\n    return obj;\n  }\n\n  // Handle serialized ArrayBuffer format: {\"0\": byte, \"1\": byte, ...}\n  if (typeof obj === 'object' && obj !== null) {\n    const keys = Object.keys(obj);\n    // Check if it looks like a serialized ArrayBuffer (numeric keys)\n    if (keys.length > 0 && keys.every(key => /^\\d+$/.test(key))) {\n      const bytes = Object.values(obj) as number[];\n      const uint8Array = new Uint8Array(bytes);\n      // Create a new ArrayBuffer and copy the data to ensure it's an ArrayBuffer, not SharedArrayBuffer\n      const buffer = new ArrayBuffer(uint8Array.length);\n      new Uint8Array(buffer).set(uint8Array);\n      return buffer;\n    }\n  }\n\n  // If it's a string, assume it's base64url encoded\n  if (typeof obj === 'string') {\n    const uint8Array = decodeBase64url(obj);\n    const buffer = new ArrayBuffer(uint8Array.length);\n    new Uint8Array(buffer).set(uint8Array);\n    return buffer;\n  }\n\n  // If conversion fails, create empty buffer (will handle below)\n  return new ArrayBuffer(0);\n}\n\n/**\n * Convert server-generated WebAuthn options to browser-compatible format\n *\n * Key transformations:\n * - Reconstructs ArrayBuffer from base64url challenge string\n * - Converts user.id from serialized to ArrayBuffer\n * - Processes excludeCredentials with proper ArrayBuffer IDs\n */\nexport function convertServerOptionsToWebAuthn(serverOptions: any, challengeString: string): PublicKeyCredentialCreationOptions {\n  // Use the challenge string from the response root, not from options\n  const challengeUint8Array = decodeBase64url(challengeString);\n  const challengeBuffer = new ArrayBuffer(challengeUint8Array.length);\n  new Uint8Array(challengeBuffer).set(challengeUint8Array);\n\n  return {\n    ...serverOptions,\n    challenge: challengeBuffer,\n    user: {\n      ...serverOptions.user,\n      id: arrayBufferFromObject(serverOptions.user.id),\n    },\n    excludeCredentials:\n      serverOptions.excludeCredentials?.map((cred: any) => ({\n        ...cred,\n        id: arrayBufferFromObject(cred.id),\n      })) || [],\n  };\n}\n\n/**\n * Convert WebAuthn credential from browser to server-compatible format\n *\n * Transforms credential data from browser's binary ArrayBuffer format\n * into a JSON-serializable format suitable for server processing and\n * database storage.\n */\nexport function convertWebAuthnCredentialToStorage(credential: {\n  id: string;\n  rawId: string;\n  response: {\n    attestationObject: string;\n    clientDataJSON: string;\n    transports?: string[];\n  };\n  authenticatorAttachment?: string | null;\n}): {\n  id: string;\n  rawId: ArrayBufferLike;\n  response: {\n    attestationObject: ArrayBufferLike;\n    clientDataJSON: ArrayBufferLike;\n    transports?: AuthenticatorTransport[];\n  };\n  type: 'public-key';\n  authenticatorAttachment?: AuthenticatorAttachment | null;\n} {\n  // Convert base64url strings to ArrayBuffers\n  const rawIdUint8Array = decodeBase64url(credential.rawId);\n  const rawIdBuffer = new ArrayBuffer(rawIdUint8Array.length);\n  new Uint8Array(rawIdBuffer).set(rawIdUint8Array);\n\n  const attestationUint8Array = decodeBase64url(credential.response.attestationObject);\n  const attestationBuffer = new ArrayBuffer(attestationUint8Array.length);\n  new Uint8Array(attestationBuffer).set(attestationUint8Array);\n\n  const clientDataUint8Array = decodeBase64url(credential.response.clientDataJSON);\n  const clientDataBuffer = new ArrayBuffer(clientDataUint8Array.length);\n  new Uint8Array(clientDataBuffer).set(clientDataUint8Array);\n\n  return {\n    id: credential.id,\n    rawId: rawIdBuffer as ArrayBufferLike,\n    response: {\n      attestationObject: attestationBuffer as ArrayBufferLike,\n      clientDataJSON: clientDataBuffer as ArrayBufferLike,\n      transports: credential.response?.transports as AuthenticatorTransport[] | undefined,\n    },\n    type: 'public-key' as const,\n    authenticatorAttachment: credential.authenticatorAttachment as AuthenticatorAttachment | null | undefined,\n  };\n}\n","import { encodeBase64url } from '@oslojs/encoding';\n\nimport type { WebAuthnCredentialResponse } from '../@types/auth.component.types';\n\n/**\n * WebAuthn error messages mapped by error name\n * Following functional programming pattern: Map over Switch\n */\nconst WEBAUTHN_REGISTRATION_ERROR_MESSAGES = new Map<string, string>([\n  ['NotAllowedError', 'Registration was cancelled or timed out. Please try again.'],\n  ['InvalidStateError', 'This authenticator is already registered. Please try a different device.'],\n  ['NotSupportedError', 'This authenticator is not supported. Please try a different device.'],\n  ['SecurityError', 'Security error occurred. Please ensure you are on a secure connection.'],\n  ['UnknownError', 'An unknown error occurred during registration. Please try again.'],\n  ['ConstraintError', 'Authenticator constraints not satisfied. Please try a different device.'],\n]);\n\nconst WEBAUTHN_AUTHENTICATION_ERROR_MESSAGES = new Map<string, string>([\n  ['NotAllowedError', 'Authentication was cancelled or timed out. Please try again.'],\n  ['InvalidStateError', 'No authenticator found for this account. Please use a registered device.'],\n  ['NotSupportedError', 'This authenticator is not supported for authentication.'],\n  ['SecurityError', 'Security error occurred. Please ensure you are on a secure connection.'],\n  ['UnknownError', 'An unknown error occurred during authentication. Please try again.'],\n  ['ConstraintError', 'Authenticator constraints not satisfied for authentication.'],\n]);\n\n/**\n * Transform WebAuthn error into user-friendly message; pure function - no side effects\n */\nfunction transformWebAuthnError(error: unknown, errorMessages: Map<string, string>, defaultMessage: string): Error {\n  if (!(error instanceof Error)) {\n    return new Error(defaultMessage);\n  }\n\n  const message = errorMessages.get(error.name) ?? `${defaultMessage}: ${error.message}`;\n  return new Error(message);\n}\n\n/**\n * Convert attestation response to credential response format - handles credential transformation\n */\nfunction convertAttestationResponse(credential: PublicKeyCredential): WebAuthnCredentialResponse {\n  const response = credential.response as AuthenticatorAttestationResponse;\n  const transports = response.getTransports ? response.getTransports() : [];\n  const authenticatorAttachment = credential.authenticatorAttachment as AuthenticatorAttachment | null;\n\n  return {\n    id: credential.id,\n    rawId: encodeBase64url(new Uint8Array(credential.rawId)),\n    type: credential.type,\n    authenticatorAttachment,\n    response: {\n      attestationObject: encodeBase64url(new Uint8Array(response.attestationObject)),\n      clientDataJSON: encodeBase64url(new Uint8Array(response.clientDataJSON)),\n      transports: transports as AuthenticatorTransport[],\n    },\n  };\n}\n\n/**\n * Convert assertion response to credential response format - handles credential transformation\n */\nfunction convertAssertionResponse(credential: PublicKeyCredential): WebAuthnCredentialResponse {\n  const response = credential.response as AuthenticatorAssertionResponse;\n\n  return {\n    id: credential.id,\n    rawId: encodeBase64url(new Uint8Array(credential.rawId)),\n    type: credential.type,\n    response: {\n      authenticatorData: encodeBase64url(new Uint8Array(response.authenticatorData)),\n      clientDataJSON: encodeBase64url(new Uint8Array(response.clientDataJSON)),\n      signature: encodeBase64url(new Uint8Array(response.signature)),\n      userHandle: response.userHandle ? encodeBase64url(new Uint8Array(response.userHandle)) : undefined,\n    },\n  };\n}\n\n/**\n * Client-side WebAuthn registration with enhanced error handling\n */\nexport async function startRegistration(options: PublicKeyCredentialCreationOptions): Promise<WebAuthnCredentialResponse> {\n  try {\n    const credential = (await navigator.credentials.create({ publicKey: options })) as PublicKeyCredential;\n\n    if (!credential?.response) {\n      throw new Error('Failed to create credential');\n    }\n\n    return convertAttestationResponse(credential);\n  } catch (error) {\n    throw transformWebAuthnError(error, WEBAUTHN_REGISTRATION_ERROR_MESSAGES, 'Registration failed with an unknown error');\n  }\n}\n\n/**\n * Client-side WebAuthn authentication with enhanced error handling\n */\nexport async function startAuthentication(options: PublicKeyCredentialRequestOptions): Promise<WebAuthnCredentialResponse> {\n  try {\n    const credential = (await navigator.credentials.get({\n      publicKey: options,\n    })) as PublicKeyCredential;\n\n    if (!credential?.response) {\n      throw new Error('Failed to get credential');\n    }\n\n    return convertAssertionResponse(credential);\n  } catch (error) {\n    throw transformWebAuthnError(error, WEBAUTHN_AUTHENTICATION_ERROR_MESSAGES, 'Authentication failed with an unknown error');\n  }\n}\n\n/**\n * Check if WebAuthn is supported\n */\nexport function isWebAuthnSupported(): boolean {\n  return !!(typeof window !== 'undefined' && window.PublicKeyCredential && navigator?.credentials && typeof navigator.credentials.create === 'function' && typeof navigator.credentials.get === 'function');\n}\n\n/**\n * Check if platform authenticator is available\n */\nexport async function isPlatformAuthenticatorAvailable(): Promise<boolean> {\n  if (!isWebAuthnSupported()) {\n    return false;\n  }\n\n  try {\n    return await window.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Get browser capabilities for WebAuthn\n */\nexport async function getBrowserCapabilities(): Promise<{ webauthnSupported: boolean; platformAuthenticatorAvailable: boolean; conditionalMediationSupported: boolean }> {\n  const webauthnSupported = isWebAuthnSupported();\n  const platformAuthenticatorAvailable = webauthnSupported ? await isPlatformAuthenticatorAvailable() : false;\n\n  let conditionalMediationSupported = false;\n  if (webauthnSupported && 'PublicKeyCredential' in window) {\n    try {\n      // Check if conditional mediation is supported (for passkey autofill)\n      conditionalMediationSupported = await window.PublicKeyCredential.isConditionalMediationAvailable();\n    } catch {\n      conditionalMediationSupported = false;\n    }\n  }\n\n  return { webauthnSupported, platformAuthenticatorAvailable, conditionalMediationSupported };\n}\n\n/**\n * Get user-friendly error message for WebAuthn operations\n */\nexport function getWebAuthnErrorMessage(error: Error, operation: 'registration' | 'authentication'): string {\n  const operationText = operation === 'registration' ? 'add a passkey' : 'sign in';\n\n  // Map of message patterns to user-friendly messages\n  const messagePatterns = new Map<string, string>([\n    ['cancelled', `The ${operationText} process was cancelled or timed out. Please try again.`],\n    ['timed out', `The ${operationText} process was cancelled or timed out. Please try again.`],\n    ['already registered', 'This device is already registered. Please try a different device.'],\n    ['not supported', `This device or browser doesn't support the required security features. Please try a different device.`],\n    ['Security error', 'Please ensure you are using a secure connection (HTTPS) and try again.'],\n  ]);\n\n  for (const [pattern, message] of messagePatterns) {\n    if (error.message.includes(pattern)) {\n      return message;\n    }\n  }\n\n  // Fallback to original error message\n  return `Failed to ${operationText}. ${error.message}`;\n}\n","import { DateFormat } from '@ycore/componentry/impetus/intl';\nimport { AlertDialog, Badge, Button, Card, Input, Label, Link, Separator, Spinner } from '@ycore/componentry/vibrant';\nimport { createFetcherFieldProps, SecureFetcherError, useSecureFetcher } from '@ycore/foundry/secure';\nimport clsx from 'clsx';\nimport { useEffect, useRef, useState } from 'react';\nimport { Form } from 'react-router';\n\nimport type { AuthenticatorsCardProps, ProfileCardProps, ProfilePageProps } from '../@types/auth.component.types';\nimport { convertServerOptionsToWebAuthn } from '../server/webauthn-credential';\nimport { isWebAuthnSupported, startRegistration } from './webauthn-client';\n\nexport function ProfileCard({ user, signoutUrl, verifyUrl, pendingEmailChange }: ProfileCardProps): React.JSX.Element {\n  const [isEditingEmail, setIsEditingEmail] = useState(false);\n  const [newEmail, setNewEmail] = useState('');\n  const emailFetcher = useSecureFetcher();\n  const cancelFetcher = useSecureFetcher();\n  const deleteFetcher = useSecureFetcher();\n  const cancelDeleteFetcher = useSecureFetcher();\n\n  const isChangingEmail = emailFetcher.state === 'submitting';\n  const isCancelling = cancelFetcher.state === 'submitting';\n  const isDeletingAccount = deleteFetcher.state === 'submitting';\n  const isCancellingDelete = cancelDeleteFetcher.state === 'submitting';\n\n  const handleChangeEmail = () => {\n    const formData = new FormData();\n    formData.append('intent', 'request-email-change');\n    formData.append('newEmail', newEmail.trim());\n    emailFetcher.submitSecure(formData, { method: 'post' });\n  };\n\n  const handleCancelChange = () => {\n    const formData = new FormData();\n    formData.append('intent', 'cancel-email-change');\n    cancelFetcher.submitSecure(formData, { method: 'post' });\n  };\n\n  const handleRequestAccountDelete = () => {\n    const formData = new FormData();\n    formData.append('intent', 'request-account-delete');\n    deleteFetcher.submitSecure(formData, { method: 'post' });\n  };\n\n  const handleCancelAccountDelete = () => {\n    const formData = new FormData();\n    formData.append('intent', 'cancel-account-delete');\n    cancelDeleteFetcher.submitSecure(formData, { method: 'post' });\n  };\n\n  // Reset form after successful submission\n  useEffect(() => {\n    if (emailFetcher.state === 'idle' && emailFetcher.data) {\n      const data = emailFetcher.data as { success?: boolean };\n      if (data.success) {\n        setIsEditingEmail(false);\n        setNewEmail('');\n      }\n    }\n  }, [emailFetcher.state, emailFetcher.data]);\n\n  // Reset editing state after successful cancellation\n  useEffect(() => {\n    if (cancelFetcher.state === 'idle' && cancelFetcher.data) {\n      const data = cancelFetcher.data as { success?: boolean };\n      if (data.success) {\n        setIsEditingEmail(false);\n      }\n    }\n  }, [cancelFetcher.state, cancelFetcher.data]);\n\n  return (\n    <Card>\n      <Card.Header>\n        <Card.Title className=\"flex items-end gap-4\">\n          <div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-primary text-primary-foreground\">{user?.displayName?.charAt(0)?.toUpperCase() || user?.email?.charAt(0)?.toUpperCase() || '?'}</div>\n          <h3 className=\"font-semibold text-lg\">{user?.displayName || 'Profile'}</h3>\n        </Card.Title>\n      </Card.Header>\n\n      <Card.Content className=\"space-y-6\">\n        {/* Pending Email Change Banner */}\n        {pendingEmailChange && (\n          <div className=\"rounded-lg border border-blue-200 bg-blue-50 p-4\">\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex-1\">\n                <p className=\"font-medium text-blue-900 text-sm\">Email Change Pending</p>\n                <p className=\"mt-1 text-blue-700 text-xs\">\n                  Pending verification for: <span className=\"font-medium\">{pendingEmailChange.newEmail}</span>\n                </p>\n                <p className=\"mt-2 text-blue-600 text-xs\">Visit the verification page and request a code to be sent to your new email address.</p>\n              </div>\n              <div className=\"flex gap-2\">\n                <Button asChild variant=\"default\" size=\"sm\">\n                  <Link href={verifyUrl}>Verify Now</Link>\n                </Button>\n                <Button onClick={handleCancelChange} disabled={isCancelling} variant=\"ghost\" size=\"sm\">\n                  {isCancelling ? 'Cancelling...' : 'Cancel'}\n                </Button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Pending Account Delete Banner */}\n        {user?.pending?.type === 'account-delete' && (\n          <div className=\"rounded-lg border border-destructive/50 p-4\">\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex-1\">\n                <p className=\"font-medium text-destructive text-sm\">Account Deletion Pending</p>\n                <p className=\"mt-1 text-destructive text-xs\">Your account deletion request is pending verification.</p>\n                <p className=\"mt-2 text-destructive text-xs\">Visit the verification page and enter the code sent to your email to confirm deletion.</p>\n              </div>\n              <div className=\"flex gap-2\">\n                <Button asChild variant=\"destructive\" size=\"sm\">\n                  <Link href={verifyUrl}>Verify Deletion</Link>\n                </Button>\n                <Button onClick={handleCancelAccountDelete} disabled={isCancellingDelete} variant=\"ghost\" size=\"sm\">\n                  {isCancellingDelete ? 'Cancelling...' : 'Cancel'}\n                </Button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        <div className=\"grid gap-4\">\n          {/* Email Section */}\n          <div className=\"space-y-2\">\n            <Label className=\"text-muted-foreground text-sm\">Email Address</Label>\n            {!isEditingEmail ? (\n              <div className=\"flex items-center justify-between\">\n                <p className=\"text-sm\">{user?.email}</p>\n                {!pendingEmailChange && (\n                  <Button onClick={() => setIsEditingEmail(true)} variant=\"ghost\" size=\"sm\">\n                    Change\n                  </Button>\n                )}\n              </div>\n            ) : (\n              <div className=\"space-y-2\">\n                <Input\n                  value={newEmail}\n                  onChange={(e: React.ChangeEvent<HTMLInputElement>) => setNewEmail(e.target.value)}\n                  placeholder=\"Enter new email address\"\n                  type=\"email\"\n                  className=\"h-9\"\n                  {...createFetcherFieldProps('newEmail', emailFetcher.errors)}\n                />\n                <SecureFetcherError error={emailFetcher.errors?.newEmail} />\n                {emailFetcher.errors?.form && <SecureFetcherError error={emailFetcher.errors.form} />}\n                <div className=\"flex gap-2\">\n                  <Button onClick={handleChangeEmail} disabled={isChangingEmail || !newEmail.trim()} size=\"sm\">\n                    {isChangingEmail ? 'Sending...' : 'Send Verification'}\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      setIsEditingEmail(false);\n                      setNewEmail('');\n                    }}\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </div>\n            )}\n          </div>\n\n          <div className=\"flex justify-between pt-6\">\n            {user?.createdAt && (\n              <div className=\"space-y-2\">\n                <Label className=\"text-muted-foreground text-sm\">Since</Label>\n                <p className=\"text-sm\">\n                  <DateFormat.Long date={user.createdAt} />\n                </p>\n              </div>\n            )}\n\n            {user?.status === 'active' ? (\n              <Badge variant=\"outline\" className=\"h-8 px-4 text-primary\">\n                Verified Account\n              </Badge>\n            ) : (\n              <Button asChild variant=\"default\" size=\"sm\" className=\"bg-amber-600 hover:bg-amber-700\">\n                <Link href={verifyUrl}>Verify Email</Link>\n              </Button>\n            )}\n          </div>\n        </div>\n\n        <div className=\"flex justify-end\">\n          <Form method=\"post\" action={signoutUrl}>\n            <Button type=\"submit\" variant=\"secondary\" size=\"sm\">\n              Sign Out\n            </Button>\n          </Form>\n        </div>\n      </Card.Content>\n\n      <Separator />\n\n      <Card.Footer>\n        {/* Danger Zone - Only show if no pending operations */}\n        {!pendingEmailChange && user?.pending?.type !== 'account-delete' && (\n          <div className=\"rounded-lg border border-destructive/50 p-4\">\n            <div className=\"space-y-3\">\n              <div className=\"flex justify-start\">\n                <AlertDialog>\n                  <AlertDialog.Trigger asChild>\n                    <Button variant=\"destructive\" size=\"sm\" disabled={isDeletingAccount}>\n                      {isDeletingAccount ? 'Processing...' : 'Delete Account'}\n                    </Button>\n                  </AlertDialog.Trigger>\n                  <AlertDialog.Content>\n                    <AlertDialog.Header>\n                      <AlertDialog.Title>Delete Account</AlertDialog.Title>\n                      <AlertDialog.Description asChild>\n                        <div className=\"space-y-3\">\n                          <p className=\"font-semibold text-destructive\">This action cannot be undone.</p>\n                          <p>Deleting your account will:</p>\n                          <ul className=\"list-disc space-y-1 pl-5 text-sm\">\n                            <li>Permanently remove all your account data</li>\n                            <li>Delete all registered passkeys and authenticators</li>\n                            <li>Sign you out immediately after verification</li>\n                            <li>Make your email address available for new registrations</li>\n                          </ul>\n                          <p className=\"text-sm\">You will receive a verification code via email to confirm this action.</p>\n                        </div>\n                      </AlertDialog.Description>\n                    </AlertDialog.Header>\n                    <AlertDialog.Footer>\n                      <AlertDialog.Cancel>Cancel</AlertDialog.Cancel>\n                      <AlertDialog.Action onClick={handleRequestAccountDelete} className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\">\n                        Continue to Verification\n                      </AlertDialog.Action>\n                    </AlertDialog.Footer>\n                  </AlertDialog.Content>\n                </AlertDialog>\n              </div>\n              {deleteFetcher.errors?.form && <SecureFetcherError error={deleteFetcher.errors.form} />}\n              <p className=\"mt-1 text-destructive/80 text-xs\">Permanently delete your account and all associated data.</p>\n            </div>\n          </div>\n        )}\n      </Card.Footer>\n    </Card>\n  );\n}\n\nexport function AuthenticatorsCard({ authenticators, profileUrl }: AuthenticatorsCardProps): React.JSX.Element {\n  const addFetcher = useSecureFetcher();\n  const renameFetcher = useSecureFetcher();\n  const deleteFetcher = useSecureFetcher();\n  const optionsFetcher = useSecureFetcher();\n\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [editingName, setEditingName] = useState('');\n  const [pendingAction, setPendingAction] = useState<{ type: 'add'; authenticatorId?: string } | null>(null);\n  const [isRegistering, setIsRegistering] = useState(false);\n  const [webAuthnError, setWebAuthnError] = useState<string | null>(null);\n  const [isClient, setIsClient] = useState(false);\n  const [processedFetcherId, setProcessedFetcherId] = useState<string | null>(null);\n\n  // Form refs for programmatic submission after WebAuthn\n  const abortControllerRef = useRef<AbortController | null>(null);\n  const freshCsrfTokenRef = useRef<string | null>(null);\n\n  // Handle WebAuthn registration flow for add\n  useEffect(() => {\n    // Handle options response (data is returned directly, not wrapped in success/data)\n    // Prevent duplicate processing by checking if we've already processed this data\n    const currentFetcherId = optionsFetcher.state + JSON.stringify(optionsFetcher.data);\n    if (optionsFetcher.data && pendingAction && processedFetcherId !== currentFetcherId) {\n      setProcessedFetcherId(currentFetcherId);\n      const performWebAuthnRegistration = async () => {\n        try {\n          setIsRegistering(true);\n          setWebAuthnError(null);\n\n          // Create AbortController for this operation\n          abortControllerRef.current = new AbortController();\n\n          const responseData = optionsFetcher.data as { challenge?: string; options?: any; csrfToken?: string };\n\n          // Validate response structure\n          if (!responseData || !responseData.challenge || !responseData.options) {\n            console.error('Invalid options response structure:', responseData);\n            throw new Error('Invalid response from server. Please try again.');\n          }\n\n          const { challenge, options, csrfToken: freshCsrfToken } = responseData;\n\n          // Store the fresh CSRF token if provided\n          if (freshCsrfToken) {\n            freshCsrfTokenRef.current = freshCsrfToken;\n          }\n\n          // Convert server options to WebAuthn API format\n          let webAuthnOptions: PublicKeyCredentialCreationOptions;\n          try {\n            webAuthnOptions = convertServerOptionsToWebAuthn(options, challenge);\n          } catch (conversionError) {\n            console.error('Options conversion failed:', conversionError);\n            throw new Error('Failed to process registration options. Please try again.');\n          }\n\n          // Create timeout promise\n          const timeoutPromise = new Promise<never>((_, reject) => {\n            const timeoutId = setTimeout(() => {\n              reject(new Error('Registration timed out. Please try again.'));\n            }, 60000);\n\n            // Clear timeout if aborted\n            abortControllerRef.current?.signal.addEventListener('abort', () => {\n              clearTimeout(timeoutId);\n            });\n          });\n\n          // Race between WebAuthn registration and timeout\n          const credential = await Promise.race([startRegistration(webAuthnOptions), timeoutPromise]);\n\n          // Check if still mounted and not aborted\n          if (abortControllerRef.current?.signal.aborted) {\n            return;\n          }\n\n          // Submit based on action type\n          const formData = new FormData();\n          if (pendingAction.type === 'add') {\n            formData.append('intent', 'add-passkey');\n            formData.append('challenge', challenge);\n            formData.append('credentialData', JSON.stringify(credential));\n\n            // Use the fresh CSRF token from the response if available\n            if (freshCsrfTokenRef.current) {\n              formData.append('csrf_token', freshCsrfTokenRef.current);\n            }\n\n            addFetcher.submitSecure(formData, { method: 'post', action: profileUrl });\n          }\n\n          setPendingAction(null);\n          setIsRegistering(false);\n        } catch (error) {\n          // Check if component is still mounted and operation wasn't aborted\n          if (abortControllerRef.current?.signal.aborted) {\n            return;\n          }\n\n          setIsRegistering(false);\n          setPendingAction(null);\n\n          // Provide more specific error messages\n          let errorMessage = 'Registration failed';\n          if (error instanceof Error) {\n            if (error.message.includes('cancelled')) {\n              errorMessage = 'Registration was cancelled. Please try again when ready.';\n            } else if (error.message.includes('timed out')) {\n              errorMessage = error.message;\n            } else if (error.message.includes('already registered')) {\n              errorMessage = 'This authenticator is already registered.';\n            } else {\n              errorMessage = error.message;\n            }\n          }\n          setWebAuthnError(errorMessage);\n        }\n      };\n\n      performWebAuthnRegistration();\n    }\n  }, [optionsFetcher.data, optionsFetcher.state, pendingAction, processedFetcherId, addFetcher]);\n\n  // Cleanup abort controller on unmount\n  useEffect(() => {\n    return () => {\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n      }\n    };\n  }, []);\n\n  // Set client state after hydration\n  useEffect(() => {\n    setIsClient(true);\n  }, []);\n\n  // Monitor add fetcher state changes\n  useEffect(() => {\n    if (addFetcher.data && addFetcher.state === 'idle') {\n      setWebAuthnError(null);\n      setIsRegistering(false);\n    }\n\n    // Check for errors from fetcher\n    if (addFetcher.state === 'idle' && addFetcher.errors?.form) {\n      setWebAuthnError(addFetcher.errors.form);\n      setIsRegistering(false);\n    }\n  }, [addFetcher.data, addFetcher.state, addFetcher.errors]);\n\n  const handleAddPasskey = () => {\n    // Clear any previous errors\n    setWebAuthnError(null);\n\n    if (!isWebAuthnSupported()) {\n      setWebAuthnError('WebAuthn is not supported on this device');\n      return;\n    }\n\n    setPendingAction({ type: 'add' });\n\n    // Request registration options from server (server has correct RP ID logic)\n    const formData = new FormData();\n    formData.append('intent', 'add-passkey-options');\n    optionsFetcher.submitSecure(formData, { method: 'post', action: profileUrl });\n  };\n\n  const handleStartEdit = (authenticator: (typeof authenticators)[0]) => {\n    setEditingId(authenticator.id);\n    setEditingName(authenticator.name || '');\n  };\n\n  const handleSaveEdit = () => {\n    if (!editingId) return;\n\n    const formData = new FormData();\n    formData.append('intent', 'rename-passkey');\n    formData.append('authenticatorId', editingId);\n    formData.append('name', editingName.trim());\n\n    renameFetcher.submitSecure(formData, { method: 'post', action: profileUrl });\n\n    setEditingId(null);\n    setEditingName('');\n  };\n\n  const handleCancelEdit = () => {\n    setEditingId(null);\n    setEditingName('');\n  };\n\n  const handleDeletePasskey = (authenticatorId: string) => {\n    const formData = new FormData();\n    formData.append('intent', 'delete-passkey');\n    formData.append('authenticatorId', authenticatorId);\n\n    deleteFetcher.submitSecure(formData, { method: 'post', action: profileUrl });\n  };\n\n  // Determine loading states\n  const isAddingPasskey = addFetcher.state === 'submitting' || isRegistering || (optionsFetcher.state !== 'idle' && pendingAction?.type === 'add');\n\n  const isRenamingPasskey = renameFetcher.state === 'submitting';\n  const isDeletingPasskey = (id: string) => deleteFetcher.state === 'submitting' && deleteFetcher.formData?.get('authenticatorId') === id;\n\n  return (\n    <Card>\n      <Card.Header>\n        <div className=\"flex items-center justify-between gap-4\">\n          <div className=\"space-y-2\">\n            <Card.Title className=\"flex items-center\">Passkeys</Card.Title>\n            <Card.Description>Security keys and devices used to sign in to your account</Card.Description>\n          </div>\n          <Button onClick={handleAddPasskey} disabled={isAddingPasskey || authenticators.length >= 10 || (isClient && !isWebAuthnSupported())} size=\"sm\">\n            <Spinner className={clsx('mr-1 size-4', !isAddingPasskey && 'hidden')} />\n            {isAddingPasskey ? (isRegistering ? 'Setting up...' : 'Adding...') : 'Add Passkey'}\n          </Button>\n        </div>\n      </Card.Header>\n\n      <Card.Content>\n        {/* WebAuthn error display */}\n        {webAuthnError && (\n          <div className=\"mb-4 rounded-lg border border-destructive p-3\">\n            <p className=\"font-medium text-destructive text-sm\">Registration Failed</p>\n            <SecureFetcherError error={webAuthnError} className=\"mt-1 text-destructive text-xs\" />\n          </div>\n        )}\n\n        {/* Add passkey errors from server */}\n        {addFetcher.errors?.form && !webAuthnError && (\n          <div className=\"mb-4\">\n            <SecureFetcherError error={addFetcher.errors.form} />\n          </div>\n        )}\n\n        {/* Delete passkey errors */}\n        {deleteFetcher.errors?.form && (\n          <div className=\"mb-4\">\n            <SecureFetcherError error={deleteFetcher.errors.form} />\n          </div>\n        )}\n\n        {/* Registration in progress indicator */}\n        {isRegistering && (\n          <div className=\"mb-4 rounded-lg border border-blue-200 bg-blue-50 p-3 text-blue-700 text-sm\">\n            <div className=\"flex items-center gap-2\">\n              <Spinner className=\"size-4\" />\n              <span>Please set up your authenticator...</span>\n            </div>\n            <p className=\"mt-1 text-xs\">Follow the prompts to create a passkey on your device.</p>\n          </div>\n        )}\n\n        {authenticators.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n            <h4 className=\"mb-2 font-medium text-muted-foreground\">No passkeys registered</h4>\n            <p className=\"max-w-sm text-muted-foreground text-sm\">Add a security key or biometric device to secure your account</p>\n          </div>\n        ) : (\n          <div className=\"space-y-3\">\n            {authenticators.map(auth => (\n              <div key={auth.id} className=\"rounded-lg border p-4\">\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      {editingId === auth.id ? (\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <Input\n                              value={editingName}\n                              onChange={(e: React.ChangeEvent<HTMLInputElement>) => setEditingName(e.target.value)}\n                              className=\"h-8 w-48\"\n                              placeholder=\"Enter passkey name\"\n                              {...createFetcherFieldProps('name', renameFetcher.errors)}\n                            />\n                            <Button size=\"sm\" onClick={handleSaveEdit} disabled={isRenamingPasskey}>\n                              {isRenamingPasskey ? 'Saving...' : 'Save'}\n                            </Button>\n                            <Button size=\"sm\" variant=\"outline\" onClick={handleCancelEdit}>\n                              Cancel\n                            </Button>\n                          </div>\n                          <SecureFetcherError error={renameFetcher.errors?.name} className=\"text-xs\" />\n                        </div>\n                      ) : (\n                        <>\n                          <h4 className=\"font-medium text-sm\">{auth.name}</h4>\n                          <span className=\"text-muted-foreground text-xs\">•</span>\n                          <p className=\"text-muted-foreground text-xs uppercase\">{auth.credentialDeviceType}</p>\n                          {auth.credentialBackedUp && (\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              Synced\n                            </Badge>\n                          )}\n                        </>\n                      )}\n                    </div>\n\n                    {editingId !== auth.id && (\n                      <div className=\"flex items-center gap-1\">\n                        <Button size=\"sm\" variant=\"ghost\" onClick={() => handleStartEdit(auth)} className=\"h-8 px-2\">\n                          Edit\n                        </Button>\n                        <AlertDialog>\n                          <AlertDialog.Trigger asChild>\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-8 px-2 text-destructive hover:text-destructive\" disabled={authenticators.length <= 1 || isDeletingPasskey(auth.id)}>\n                              {isDeletingPasskey(auth.id) ? 'Deleting...' : 'Delete'}\n                            </Button>\n                          </AlertDialog.Trigger>\n                          <AlertDialog.Content>\n                            <AlertDialog.Header>\n                              <AlertDialog.Title>Delete Passkey</AlertDialog.Title>\n                              <AlertDialog.Description asChild>\n                                <div>\n                                  <p>Are you sure you want to delete \"{auth.name}\"? This action cannot be undone.</p>\n                                  {authenticators.length <= 1 && <p className=\"mt-2 text-destructive text-sm\">You cannot delete your last passkey as it would lock you out of your account.</p>}\n                                </div>\n                              </AlertDialog.Description>\n                            </AlertDialog.Header>\n                            <AlertDialog.Footer>\n                              <AlertDialog.Cancel>Cancel</AlertDialog.Cancel>\n                              <AlertDialog.Action onClick={() => handleDeletePasskey(auth.id)} className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\">\n                                Delete Passkey\n                              </AlertDialog.Action>\n                            </AlertDialog.Footer>\n                          </AlertDialog.Content>\n                        </AlertDialog>\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"flex flex-wrap gap-1\">\n                    {auth.transports.map(transport => (\n                      <Badge key={transport} variant=\"secondary\" className=\"text-xs\">\n                        {transport.toUpperCase()}\n                      </Badge>\n                    ))}\n                  </div>\n\n                  <div className=\"flex justify-between text-muted-foreground text-xs\">\n                    <span className=\"flex items-center gap-1\">\n                      <Label>Added:</Label>\n                      <DateFormat.Medium date={auth.createdAt} />\n                    </span>\n                    {auth.lastUsedAt ? (\n                      <span className=\"flex items-center gap-1\">\n                        <Label>Last used:</Label>\n                        <DateFormat.Medium date={auth.lastUsedAt} />\n                      </span>\n                    ) : (\n                      <span>Never used</span>\n                    )}\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {authenticators.length >= 10 && (\n          <div className=\"mt-4 rounded-lg bg-muted p-3\">\n            <p className=\"text-muted-foreground text-sm\">You have reached the maximum limit of 10 passkeys. Delete an existing passkey to add a new one.</p>\n          </div>\n        )}\n      </Card.Content>\n    </Card>\n  );\n}\n\nexport function ProfilePage({ children }: ProfilePageProps): React.JSX.Element {\n  return (\n    <div className=\"mx-auto max-w-2xl px-4 py-8\">\n      <div className=\"mb-8\">\n        <h1 className=\"font-bold text-2xl tracking-tight\">Account Settings</h1>\n        <p className=\"text-muted-foreground\">Manage your account information and security settings</p>\n      </div>\n\n      <div className=\"space-y-6\">{children}</div>\n    </div>\n  );\n}\n","import { Button, Card, Input, Link } from '@ycore/componentry/vibrant';\nimport { formErrors, isError } from '@ycore/forge/result';\nimport { FormError, FormField, SecureForm, SecureProvider } from '@ycore/foundry/secure';\nimport { useActionData, useLoaderData, useNavigation } from 'react-router';\nimport type { RecoverFormProps, RecoverPageProps } from '../@types/auth.component.types';\n\nexport function RecoverForm({ signinUrl }: RecoverFormProps): React.JSX.Element {\n  const navigation = useNavigation();\n  const actionData = useActionData<any>();\n  const isSubmitting = navigation.state === 'submitting';\n  const errors = isError(actionData) ? formErrors(actionData) : {};\n\n  return (\n    <SecureForm method=\"post\" className=\"flex flex-col gap-6\">\n      <input type=\"hidden\" name=\"intent\" value=\"recover\" />\n\n      <FormField label=\"Email\" error={errors.email}>\n        <Input name=\"email\" type=\"email\" placeholder=\"Enter your email\" autoComplete=\"email\" required autoFocus />\n      </FormField>\n\n      {errors.form && <FormError error={errors.form} />}\n\n      <div className=\"flex justify-between gap-x-2\">\n        <Button type=\"submit\" disabled={isSubmitting} className=\"flex-1\">\n          {isSubmitting ? 'Sending Recovery Code...' : 'Send Recovery Code'}\n        </Button>\n\n        <Button type=\"button\" variant=\"outline\" asChild disabled={isSubmitting}>\n          <Link href={signinUrl}>Sign In</Link>\n        </Button>\n      </div>\n    </SecureForm>\n  );\n}\n\nexport function RecoverPage({ children, title = 'Account Recovery', description = 'Lost access to your passkeys? Enter your registered email to recover access.' }: RecoverPageProps): React.JSX.Element {\n  const loaderData = useLoaderData<any>();\n  const token = isError(loaderData) ? '' : (loaderData?.token ?? '');\n\n  return (\n    <SecureProvider token={token}>\n      <div className=\"mx-auto min-w-md max-w-lg px-4 py-8\">\n        <Card>\n          <Card.Header>\n            <Card.Title>{title}</Card.Title>\n            <Card.Description>{description}</Card.Description>\n          </Card.Header>\n          <Card.Content>{children}</Card.Content>\n        </Card>\n      </div>\n    </SecureProvider>\n  );\n}\n","import type { DeviceInfo } from './@types/auth.types';\n\n// WebAuthn Algorithm Constants\nexport const WEBAUTHN_ALGORITHMS = {\n  ES256: -7,\n  RS256: -257,\n} as const;\n\n// WebAuthn Configuration Constants\nexport const WEBAUTHN_CONFIG = {\n  CHALLENGE_TIMEOUT: 60000, // 60 seconds\n  CHALLENGE_SIZE: 32, // 32 bytes\n  USER_ID_SIZE: 16, // 16 bytes\n  COORDINATE_LENGTH: 32, // P-256 coordinates should be 32 bytes each\n  HEX_COORDINATE_LENGTH: 64, // 32 bytes = 64 hex characters\n} as const;\n\n// Transport Methods\nexport const TRANSPORT_METHODS = {\n  INTERNAL: 'internal',\n  HYBRID: 'hybrid',\n  USB: 'usb',\n  NFC: 'nfc',\n  BLE: 'ble',\n  SMART_CARD: 'smart-card',\n} as const;\n\n// Attestation Types\nexport const ATTESTATION_TYPES = {\n  NONE: 'none',\n  BASIC: 'basic',\n  SELF: 'self',\n  ATTCA: 'attca',\n  ECDAA: 'ecdaa',\n} as const;\n\n// Device Types\nexport const DEVICE_TYPES = {\n  PLATFORM: 'platform',\n  CROSS_PLATFORM: 'cross-platform',\n} as const;\n\n// Authenticator Flags (WebAuthn spec bit positions)\nexport const AUTHENTICATOR_FLAGS = {\n  BACKUP_ELIGIBLE: 0x08, // BE flag (bit 3)\n  BACKUP_STATE: 0x10, // BS flag (bit 4)\n} as const;\n\n// Legacy device registry removed - replaced with KV-based MDS lookup with fallback to DEFAULT_DEVICE_INFO\n\n// Default Device Info for Unknown Devices\nexport const DEFAULT_DEVICE_INFO: Record<'platform' | 'cross-platform', DeviceInfo> = {\n  platform: {\n    type: DEVICE_TYPES.PLATFORM,\n    vendor: 'Unknown',\n    model: 'Platform Authenticator',\n    certified: false,\n    transports: [TRANSPORT_METHODS.INTERNAL, TRANSPORT_METHODS.HYBRID],\n  },\n  'cross-platform': {\n    type: DEVICE_TYPES.CROSS_PLATFORM,\n    vendor: 'Unknown',\n    model: 'Security Key',\n    certified: false,\n    transports: [TRANSPORT_METHODS.USB, TRANSPORT_METHODS.NFC, TRANSPORT_METHODS.HYBRID],\n  },\n} as const;\n\n// Attestation Format to Type Mapping using Command Pattern\ntype AttestationFormatHandler = (attStmt: any) => string;\n\nexport const ATTESTATION_FORMAT_HANDLERS = new Map<string, AttestationFormatHandler>([\n  ['none', () => ATTESTATION_TYPES.NONE],\n  [\n    'packed',\n    attStmt => {\n      if (attStmt.x5c && attStmt.x5c.length > 0) {\n        return ATTESTATION_TYPES.BASIC;\n      }\n      if (attStmt.sig && !attStmt.x5c) {\n        return ATTESTATION_TYPES.SELF;\n      }\n      return ATTESTATION_TYPES.NONE;\n    },\n  ],\n  [\n    'fido-u2f',\n    attStmt => {\n      if (attStmt.x5c && attStmt.x5c.length > 0) {\n        return ATTESTATION_TYPES.BASIC;\n      }\n      return ATTESTATION_TYPES.SELF;\n    },\n  ],\n  ['android-key', () => ATTESTATION_TYPES.BASIC],\n  ['android-safetynet', () => ATTESTATION_TYPES.ATTCA],\n  ['tpm', () => ATTESTATION_TYPES.BASIC],\n  ['apple', () => ATTESTATION_TYPES.BASIC],\n]);\n\nexport enum WebAuthnErrorCode {\n  INVALID_CHALLENGE = 'INVALID_CHALLENGE',\n  INVALID_ORIGIN = 'INVALID_ORIGIN',\n  INVALID_RPID = 'INVALID_RPID',\n  USER_NOT_PRESENT = 'USER_NOT_PRESENT',\n  INVALID_COUNTER = 'INVALID_COUNTER',\n  SIGNATURE_FAILED = 'SIGNATURE_FAILED',\n  UNSUPPORTED_ALGORITHM = 'UNSUPPORTED_ALGORITHM',\n  INVALID_CREDENTIAL = 'INVALID_CREDENTIAL',\n  CHALLENGE_EXPIRED = 'CHALLENGE_EXPIRED',\n  INVALID_KEY_FORMAT = 'INVALID_KEY_FORMAT',\n  DEFAULT = 'DEFAULT',\n}\n\n// Error Message Resolver Type\ntype ErrorMessageResolver = (operation: 'registration' | 'authentication') => string;\n\n// WebAuthn Error Messages using Command Pattern\nexport const WEBAUTHN_ERROR_MESSAGES = new Map<WebAuthnErrorCode, ErrorMessageResolver>([\n  [WebAuthnErrorCode.CHALLENGE_EXPIRED, () => 'Session expired. Please refresh the page and try again.'],\n  [WebAuthnErrorCode.INVALID_CHALLENGE, () => 'Security check failed. Please refresh the page and try again.'],\n  [WebAuthnErrorCode.INVALID_COUNTER, () => 'Security violation detected. Your authenticator may be compromised. Please contact support immediately.'],\n  [WebAuthnErrorCode.INVALID_KEY_FORMAT, () => 'Invalid security key format. Please re-register your device.'],\n  [WebAuthnErrorCode.INVALID_ORIGIN, () => 'Request origin not recognized. Please ensure you are on the correct website.'],\n  [WebAuthnErrorCode.INVALID_RPID, () => 'Security configuration error. Please contact support.'],\n  [WebAuthnErrorCode.UNSUPPORTED_ALGORITHM, () => 'Your authenticator uses an unsupported security algorithm. Please use a different device.'],\n  [WebAuthnErrorCode.USER_NOT_PRESENT, () => 'User presence verification failed. Please interact with your authenticator when prompted.'],\n  [WebAuthnErrorCode.INVALID_CREDENTIAL, operation => (operation === 'registration' ? 'Failed to create credential. Please try again.' : 'Authenticator not recognized. Please use the device you registered with.')],\n  [\n    WebAuthnErrorCode.SIGNATURE_FAILED,\n    operation => (operation === 'registration' ? 'Failed to verify authenticator. Please try a different device.' : 'Authentication failed. Please verify you are using the correct authenticator.'),\n  ],\n  [WebAuthnErrorCode.DEFAULT, operation => (operation === 'registration' ? 'Registration failed. Please try again.' : 'Authentication failed. Please try again.')],\n]);\n\n// Utility Functions\nexport function convertAAGUIDToUUID(aaguid: Uint8Array): string {\n  const aaguidString = Array.from(aaguid)\n    .map(b => b.toString(16).padStart(2, '0'))\n    .join('');\n\n  return [aaguidString.slice(0, 8), aaguidString.slice(8, 12), aaguidString.slice(12, 16), aaguidString.slice(16, 20), aaguidString.slice(20, 32)].join('-');\n}\n\nexport function isAAGUIDAllZeros(aaguid: Uint8Array): boolean {\n  return Array.from(aaguid).every(byte => byte === 0);\n}\n","import { decodePKIXECDSASignature, ECDSAPublicKey, p256, verifyECDSASignature } from '@oslojs/crypto/ecdsa';\nimport { sha256 } from '@oslojs/crypto/sha2';\nimport { decodeBase64url, encodeBase64url } from '@oslojs/encoding';\nimport { ClientDataType, COSEKeyType, createAssertionSignatureMessage, parseAttestationObject, parseAuthenticatorData, parseClientDataJSON } from '@oslojs/webauthn';\nimport { logger } from '@ycore/forge/logger';\nimport { err, type Result } from '@ycore/forge/result';\n\nimport type { DeviceInfo, EnhancedDeviceInfo, WebAuthnAuthenticationData, WebAuthnRegistrationData } from '../@types/auth.types';\nimport {\n  ATTESTATION_FORMAT_HANDLERS,\n  ATTESTATION_TYPES,\n  AUTHENTICATOR_FLAGS,\n  convertAAGUIDToUUID,\n  DEFAULT_DEVICE_INFO,\n  isAAGUIDAllZeros,\n  WEBAUTHN_ALGORITHMS,\n  WEBAUTHN_CONFIG,\n  WEBAUTHN_ERROR_MESSAGES,\n  WebAuthnErrorCode,\n} from '../auth.constants';\nimport type { Authenticator as AuthenticatorModel } from '../schema';\n\n/**\n * Helper function to convert Uint8Array to ArrayBuffer\n * This ensures we get a proper ArrayBuffer instead of SharedArrayBuffer\n */\nfunction toArrayBuffer(uint8Array: Uint8Array): ArrayBuffer {\n  const buffer = new ArrayBuffer(uint8Array.byteLength);\n  new Uint8Array(buffer).set(uint8Array);\n  return buffer;\n}\n\n/**\n * Extract backup state from authenticator data flags\n */\nfunction extractBackupState(authenticatorData: any): { isBackupEligible: boolean; isBackedUp: boolean } {\n  const flags = authenticatorData.flags || 0;\n\n  const isBackupEligible = (flags & AUTHENTICATOR_FLAGS.BACKUP_ELIGIBLE) !== 0;\n  const isBackedUp = (flags & AUTHENTICATOR_FLAGS.BACKUP_STATE) !== 0;\n\n  return { isBackupEligible, isBackedUp };\n}\n\n/**\n * Extract transport methods based on device characteristics\n */\nfunction extractTransportMethods(deviceInfo: DeviceInfo): string[] {\n  return [...deviceInfo.transports];\n}\n\n/**\n * Extract attestation type from attestation object using command pattern\n */\nfunction extractAttestationType(attestationObject: any): string {\n  try {\n    const fmt = attestationObject.fmt;\n    const attStmt = attestationObject.attStmt;\n\n    const handler = ATTESTATION_FORMAT_HANDLERS.get(fmt);\n    if (handler) {\n      return handler(attStmt);\n    }\n\n    logger.warning('webauthn_unknown_attestation_format', { format: fmt });\n    return ATTESTATION_TYPES.NONE;\n  } catch (error) {\n    logger.error('webauthn_attestation_extraction_error', {\n      error: error instanceof Error ? error.message : 'Unknown error',\n    });\n    return ATTESTATION_TYPES.NONE;\n  }\n}\n\n/**\n * Generate a default friendly name for an authenticator\n */\nfunction generateDefaultAuthenticatorName(deviceInfo: DeviceInfo): string {\n  // If we have specific vendor/model info, use it\n  if (deviceInfo.vendor !== 'Unknown' && deviceInfo.model !== 'Security Key' && deviceInfo.model !== 'Device') {\n    return `${deviceInfo.vendor} ${deviceInfo.model}`;\n  }\n\n  // Fall back to generic names with timestamp\n  const deviceType = deviceInfo.type === 'platform' ? 'Biometric Device' : 'Security Key';\n  const timestamp = new Date().toLocaleDateString('en-US', {\n    month: 'short',\n    day: 'numeric',\n  });\n\n  return `${deviceType} (${timestamp})`;\n}\n\n/**\n * Get comprehensive device information by AAGUID with KV lookup and fallback\n */\nasync function getDeviceInfoByAAGUID(aaguid: Uint8Array, metadataKV?: KVNamespace): Promise<DeviceInfo> {\n  // If AAGUID is all zeros, it's likely a platform authenticator\n  if (isAAGUIDAllZeros(aaguid)) {\n    return DEFAULT_DEVICE_INFO.platform;\n  }\n\n  const uuid = convertAAGUIDToUUID(aaguid);\n\n  // Try KV lookup first (MDS data)\n  if (metadataKV) {\n    try {\n      const mdsData = await metadataKV.get(`device:${uuid}`, 'json');\n      if (mdsData) {\n        logger.debug('device_info_mds_hit', { uuid });\n        return mdsData as EnhancedDeviceInfo;\n      }\n    } catch (error) {\n      logger.warning('device_info_kv_lookup_failed', {\n        uuid,\n        error: error instanceof Error ? error.message : 'Unknown',\n      });\n    }\n  }\n\n  // Fallback to default\n  logger.debug('device_info_fallback', { uuid });\n  return DEFAULT_DEVICE_INFO['cross-platform'];\n}\n\nexport function getWebAuthnErrorMessage(code: WebAuthnErrorCode | undefined, operation: 'registration' | 'authentication'): string {\n  if (!code) {\n    return WEBAUTHN_ERROR_MESSAGES.get(WebAuthnErrorCode.DEFAULT)?.(operation) || 'Auth failure. Please try again.';\n  }\n\n  const messageResolver = WEBAUTHN_ERROR_MESSAGES.get(code);\n  return messageResolver ? messageResolver(operation) : WEBAUTHN_ERROR_MESSAGES.get(WebAuthnErrorCode.DEFAULT)?.(operation) || 'Auth failure. Please try again.';\n}\n\n/**\n * Generate a cryptographically secure challenge\n */\nexport function generateChallenge(): string {\n  const bytes = new Uint8Array(WEBAUTHN_CONFIG.CHALLENGE_SIZE);\n  crypto.getRandomValues(bytes);\n  return encodeBase64url(bytes);\n}\n\n/**\n * Generate a unique user ID\n */\nexport function generateUserId(): string {\n  const bytes = new Uint8Array(WEBAUTHN_CONFIG.USER_ID_SIZE);\n  crypto.getRandomValues(bytes);\n  return encodeBase64url(bytes);\n}\n\n/**\n * Create WebAuthn registration options\n */\nexport function createRegistrationOptions(\n  rpName: string,\n  rpId: string,\n  userName: string,\n  userDisplayName: string,\n  challenge: string,\n  excludeCredentials: Array<{ id: string; transports?: AuthenticatorTransport[] }> = []\n): PublicKeyCredentialCreationOptions {\n  return {\n    challenge: toArrayBuffer(decodeBase64url(challenge)),\n    rp: {\n      name: rpName,\n      id: rpId,\n    },\n    user: {\n      id: toArrayBuffer(decodeBase64url(generateUserId())),\n      name: userName,\n      displayName: userDisplayName,\n    },\n    pubKeyCredParams: [\n      { alg: WEBAUTHN_ALGORITHMS.ES256, type: 'public-key' },\n      { alg: WEBAUTHN_ALGORITHMS.RS256, type: 'public-key' },\n    ],\n    timeout: WEBAUTHN_CONFIG.CHALLENGE_TIMEOUT,\n    attestation: 'none',\n    excludeCredentials: excludeCredentials.map(cred => ({\n      id: toArrayBuffer(decodeBase64url(cred.id)),\n      type: 'public-key' as PublicKeyCredentialType,\n      // Use actual transports if available, otherwise omit (let browser decide)\n      ...(cred.transports && cred.transports.length > 0 ? { transports: cred.transports } : {}),\n    })),\n    authenticatorSelection: {\n      residentKey: 'discouraged',\n      requireResidentKey: false,\n      userVerification: 'preferred',\n    },\n  };\n}\n\n/**\n * Create WebAuthn authentication options\n */\nexport function createAuthenticationOptions(rpId: string, challenge: string, allowCredentials: Array<{ id: string; transports?: AuthenticatorTransport[] }> = []): PublicKeyCredentialRequestOptions {\n  return {\n    challenge: toArrayBuffer(decodeBase64url(challenge)),\n    rpId,\n    timeout: WEBAUTHN_CONFIG.CHALLENGE_TIMEOUT,\n    userVerification: 'preferred',\n    allowCredentials:\n      allowCredentials.length > 0\n        ? allowCredentials.map(cred => ({\n            id: toArrayBuffer(decodeBase64url(cred.id)),\n            type: 'public-key' as PublicKeyCredentialType,\n            // Use actual transports if available, otherwise omit (let browser decide)\n            ...(cred.transports && cred.transports.length > 0 ? { transports: cred.transports } : {}),\n          }))\n        : [],\n  };\n}\n\n/**\n * Verify registration response using Oslo WebAuthn\n */\nexport async function verifyRegistration(\n  credential: WebAuthnRegistrationData,\n  expectedChallenge: string,\n  expectedOrigin: string,\n  expectedRPID: string,\n  metadataKV?: KVNamespace\n): Promise<Result<Omit<AuthenticatorModel, 'userId' | 'createdAt' | 'updatedAt'>>> {\n  try {\n    // Parse attestation object\n    const attestationObject = await parseAttestationObject(new Uint8Array(credential.response.attestationObject));\n    const { authenticatorData } = attestationObject;\n\n    // Parse client data\n    const clientData = parseClientDataJSON(new Uint8Array(credential.response.clientDataJSON));\n\n    // Verify challenge - convert Uint8Array to base64url for comparison\n    const receivedChallenge = encodeBase64url(new Uint8Array(clientData.challenge));\n    if (receivedChallenge !== expectedChallenge) {\n      return err('Invalid challenge', {\n        field: 'challenge',\n        code: WebAuthnErrorCode.INVALID_CHALLENGE,\n      });\n    }\n\n    // Verify origin\n    if (clientData.origin !== expectedOrigin) {\n      return err('Invalid origin', {\n        field: 'origin',\n        code: WebAuthnErrorCode.INVALID_ORIGIN,\n      });\n    }\n\n    // Verify type\n    if (clientData.type !== ClientDataType.Create) {\n      return err('Invalid request type', {\n        field: 'type',\n        code: WebAuthnErrorCode.INVALID_CREDENTIAL,\n      });\n    }\n\n    // Verify RP ID hash\n    if (!authenticatorData.verifyRelyingPartyIdHash(expectedRPID)) {\n      return err('Invalid relying party', {\n        field: 'rpId',\n        code: WebAuthnErrorCode.INVALID_RPID,\n      });\n    }\n\n    // Verify user presence\n    if (!authenticatorData.userPresent) {\n      return err('User presence required', {\n        field: 'userPresence',\n        code: WebAuthnErrorCode.USER_NOT_PRESENT,\n      });\n    }\n\n    // Extract credential\n    const attestedCredential = authenticatorData.credential;\n    if (!attestedCredential) {\n      return err('No credential found', {\n        field: 'credential',\n        code: WebAuthnErrorCode.INVALID_CREDENTIAL,\n      });\n    }\n\n    // Verify supported algorithm - we only support ES256 (ECDSA with P-256)\n    const publicKey = attestedCredential.publicKey;\n    if (publicKey.type() !== COSEKeyType.EC2) {\n      return err('Only ES256 algorithm is supported', {\n        field: 'keyType',\n        code: WebAuthnErrorCode.UNSUPPORTED_ALGORITHM,\n      });\n    }\n\n    // Verify it's using ES256 algorithm\n    const publicKeyAlgorithm = publicKey.algorithm();\n    if (publicKeyAlgorithm !== WEBAUTHN_ALGORITHMS.ES256) {\n      return err('Only ES256 algorithm is supported', {\n        field: 'algorithm',\n        code: WebAuthnErrorCode.UNSUPPORTED_ALGORITHM,\n      });\n    }\n\n    // Store the public key's decoded object as JSON (we'll reconstruct it during verification)\n    // This approach maintains the complete COSE key structure\n    const credentialPublicKey = encodeBase64url(new TextEncoder().encode(JSON.stringify(attestedCredential.publicKey.decoded)));\n\n    // Use actual transports from the credential if available, otherwise fall back to device info\n    let transports: string[] = [];\n    if (credential.response.transports && credential.response.transports.length > 0) {\n      // Use the actual transports reported by the authenticator\n      transports = credential.response.transports;\n      logger.debug('webauthn_using_actual_transports', { transports });\n    } else {\n      // Fall back to device info based on AAGUID\n      const deviceInfo = await getDeviceInfoByAAGUID(attestedCredential.authenticatorAAGUID, metadataKV);\n      transports = extractTransportMethods(deviceInfo);\n      logger.debug('webauthn_using_fallback_transports', { transports, source: 'deviceInfo' });\n    }\n\n    // Determine device type from authenticatorAttachment if available\n    let credentialDeviceType: 'platform' | 'cross-platform' = 'cross-platform';\n    if (credential.authenticatorAttachment) {\n      credentialDeviceType = credential.authenticatorAttachment === 'platform' ? 'platform' : 'cross-platform';\n      logger.debug('webauthn_device_type_from_attachment', {\n        authenticatorAttachment: credential.authenticatorAttachment,\n        credentialDeviceType,\n      });\n    } else {\n      // Fall back to AAGUID-based detection\n      const deviceInfo = await getDeviceInfoByAAGUID(attestedCredential.authenticatorAAGUID, metadataKV);\n      credentialDeviceType = deviceInfo.type;\n      logger.debug('webauthn_device_type_from_aaguid', {\n        aaguid: encodeBase64url(attestedCredential.authenticatorAAGUID),\n        credentialDeviceType,\n      });\n    }\n\n    // Get device info for generating a friendly name\n    const deviceInfo = await getDeviceInfoByAAGUID(attestedCredential.authenticatorAAGUID, metadataKV);\n\n    // Extract backup state from authenticator flags\n    const backupState = extractBackupState(authenticatorData);\n\n    // Get algorithm from public key\n    const keyAlgorithm = attestedCredential.publicKey.algorithm();\n\n    // Extract attestation type from attestation object\n    const attestationType = extractAttestationType(attestationObject);\n\n    // Generate a default friendly name based on device info\n    const defaultName = generateDefaultAuthenticatorName(deviceInfo);\n\n    return {\n      id: encodeBase64url(attestedCredential.id),\n      credentialPublicKey,\n      counter: authenticatorData.signatureCounter,\n      credentialDeviceType,\n      credentialBackedUp: backupState.isBackedUp,\n      transports,\n      aaguid: encodeBase64url(attestedCredential.authenticatorAAGUID),\n      name: defaultName,\n      lastUsedAt: null,\n      attestationType,\n      rpId: expectedRPID,\n      algorithm: keyAlgorithm,\n    };\n  } catch (error) {\n    logger.error('webauthn_registration_error', {\n      error: error instanceof Error ? error.message : 'Unknown error',\n    });\n    return err('Registration verification failed', { field: 'general' }, { status: 500 });\n  }\n}\n\n/**\n * Verify authentication response using Oslo WebAuthn\n */\nexport async function verifyAuthentication(\n  credential: WebAuthnAuthenticationData,\n  expectedChallenge: string,\n  expectedOrigin: string,\n  expectedRPID: string,\n  storedCredential: AuthenticatorModel\n): Promise<Result<{ verified: boolean; newCounter: number }>> {\n  try {\n    // Parse authenticator data\n    const authenticatorData = parseAuthenticatorData(new Uint8Array(credential.response.authenticatorData));\n\n    // Parse client data\n    const clientData = parseClientDataJSON(new Uint8Array(credential.response.clientDataJSON));\n\n    // Verify challenge - convert Uint8Array to base64url for comparison\n    const receivedChallenge = encodeBase64url(new Uint8Array(clientData.challenge));\n    if (receivedChallenge !== expectedChallenge) {\n      return err('Invalid challenge', {\n        field: 'challenge',\n        code: WebAuthnErrorCode.INVALID_CHALLENGE,\n      });\n    }\n\n    // Verify origin\n    if (clientData.origin !== expectedOrigin) {\n      return err('Invalid origin', {\n        field: 'origin',\n        code: WebAuthnErrorCode.INVALID_ORIGIN,\n      });\n    }\n\n    // Verify type\n    if (clientData.type !== ClientDataType.Get) {\n      return err('Invalid request type', {\n        field: 'type',\n        code: WebAuthnErrorCode.INVALID_CREDENTIAL,\n      });\n    }\n\n    // Verify RP ID hash\n    if (!authenticatorData.verifyRelyingPartyIdHash(expectedRPID)) {\n      return err('Invalid relying party', {\n        field: 'rpId',\n        code: WebAuthnErrorCode.INVALID_RPID,\n      });\n    }\n\n    // Verify user presence\n    if (!authenticatorData.userPresent) {\n      return err('User presence required', {\n        field: 'userPresence',\n        code: WebAuthnErrorCode.USER_NOT_PRESENT,\n      });\n    }\n\n    // Verify counter BEFORE signature verification (prevent replay attacks)\n    // If counter is greater than 0, it must be strictly greater than stored counter\n    if (storedCredential.counter > 0 || authenticatorData.signatureCounter > 0) {\n      if (authenticatorData.signatureCounter <= storedCredential.counter) {\n        logger.critical('webauthn_authentication_counter_rollback_detected', {\n          stored: storedCredential.counter,\n          received: authenticatorData.signatureCounter,\n          credentialId: credential.id,\n          userId: storedCredential.userId,\n        });\n        return err('Security violation: Counter rollback detected', {\n          field: 'counter',\n          code: WebAuthnErrorCode.INVALID_COUNTER,\n        });\n      }\n    }\n\n    // Create assertion message for signature verification using Oslo.js utility\n    const signatureMessage = createAssertionSignatureMessage(new Uint8Array(credential.response.authenticatorData), new Uint8Array(credential.response.clientDataJSON));\n\n    // Reconstruct the COSE key from stored JSON\n    let publicKeyData: any;\n    try {\n      // Decode the stored COSE key JSON\n      const storedKeyJson = new TextDecoder().decode(decodeBase64url(storedCredential.credentialPublicKey));\n      publicKeyData = JSON.parse(storedKeyJson);\n\n      if (!publicKeyData) {\n        return err(\n          'Invalid stored public key',\n          {\n            field: 'publicKey',\n            code: WebAuthnErrorCode.INVALID_KEY_FORMAT,\n          },\n          { status: 500 }\n        ); // System error - corrupted data in DB\n      }\n    } catch (error) {\n      logger.error('webauthn_authentication_key_parse_error', {\n        error: error instanceof Error ? error.message : 'Unknown error',\n      });\n      return err(\n        'Failed to parse stored public key',\n        {\n          field: 'publicKey',\n          code: WebAuthnErrorCode.INVALID_KEY_FORMAT,\n        },\n        { status: 500 }\n      ); // System error - corrupted data in DB\n    }\n\n    // Verify the signature using ECDSA with P-256\n    try {\n      const signatureBytes = new Uint8Array(credential.response.signature);\n\n      // Extract EC2 key components for ES256 (algorithm -7)\n      // COSE key type 2 (EC2) with curve P-256 (1)\n      // Note: COSE uses negative integers as key labels: -2 for x, -3 for y\n\n      // Parse COSE key structure\n\n      const xCoordinate = publicKeyData[-2]; // x coordinate in COSE key\n      const yCoordinate = publicKeyData[-3]; // y coordinate in COSE key\n\n      if (!xCoordinate || !yCoordinate) {\n        return err('Invalid public key structure', {\n          field: 'publicKey',\n          code: WebAuthnErrorCode.INVALID_KEY_FORMAT,\n        });\n      }\n\n      // Convert coordinates to Uint8Array\n      let xBytes: Uint8Array;\n      let yBytes: Uint8Array;\n\n      try {\n        if (typeof xCoordinate === 'string') {\n          xBytes = decodeBase64url(xCoordinate);\n        } else if (Array.isArray(xCoordinate)) {\n          xBytes = new Uint8Array(xCoordinate);\n        } else if (typeof xCoordinate === 'object' && xCoordinate !== null) {\n          // Handle object format like {\"0\":179,\"1\":124,...}\n          const values = Object.values(xCoordinate) as number[];\n          xBytes = new Uint8Array(values);\n        } else {\n          xBytes = new Uint8Array(xCoordinate);\n        }\n\n        if (typeof yCoordinate === 'string') {\n          yBytes = decodeBase64url(yCoordinate);\n        } else if (Array.isArray(yCoordinate)) {\n          yBytes = new Uint8Array(yCoordinate);\n        } else if (typeof yCoordinate === 'object' && yCoordinate !== null) {\n          // Handle object format like {\"0\":179,\"1\":124,...}\n          const values = Object.values(yCoordinate) as number[];\n          yBytes = new Uint8Array(values);\n        } else {\n          yBytes = new Uint8Array(yCoordinate);\n        }\n      } catch (error) {\n        logger.error('webauthn_authentication_coordinate_decode_error', {\n          error: error instanceof Error ? error.message : 'Unknown error',\n        });\n        return err('Failed to decode key coordinates', {\n          field: 'publicKey',\n          code: WebAuthnErrorCode.INVALID_KEY_FORMAT,\n        });\n      }\n\n      // Validate coordinate lengths (P-256 coordinates should be 32 bytes each)\n      if (xBytes.length !== WEBAUTHN_CONFIG.COORDINATE_LENGTH || yBytes.length !== WEBAUTHN_CONFIG.COORDINATE_LENGTH) {\n        return err('Invalid coordinate length for P-256 key', {\n          field: 'publicKey',\n          code: WebAuthnErrorCode.INVALID_KEY_FORMAT,\n        });\n      }\n\n      // Convert bytes to bigint for ECDSAPublicKey constructor\n      const xHex = Array.from(xBytes)\n        .map(b => b.toString(16).padStart(2, '0'))\n        .join('');\n      const yHex = Array.from(yBytes)\n        .map(b => b.toString(16).padStart(2, '0'))\n        .join('');\n\n      if (xHex.length === 0 || yHex.length === 0) {\n        return err('Empty coordinate data', {\n          field: 'publicKey',\n          code: WebAuthnErrorCode.INVALID_KEY_FORMAT,\n        });\n      }\n\n      // Ensure coordinates are exactly 64 hex characters (32 bytes)\n      const xHexPadded = xHex.padStart(WEBAUTHN_CONFIG.HEX_COORDINATE_LENGTH, '0');\n      const yHexPadded = yHex.padStart(WEBAUTHN_CONFIG.HEX_COORDINATE_LENGTH, '0');\n\n      const xBigInt = BigInt(`0x${xHexPadded}`);\n      const yBigInt = BigInt(`0x${yHexPadded}`);\n\n      // Convert coordinates for ECDSAPublicKey constructor\n\n      // Create public key using ECDSAPublicKey constructor with P-256 curve\n      const publicKey = new ECDSAPublicKey(p256, xBigInt, yBigInt);\n\n      // Validate that the public key is on the P-256 curve\n      if (!publicKey.isCurve(p256)) {\n        return err('Public key not on P-256 curve', {\n          field: 'publicKey',\n          code: WebAuthnErrorCode.INVALID_KEY_FORMAT,\n        });\n      }\n\n      // Additional validation: try encoding the public key to SEC1 format to verify it's valid\n      try {\n        publicKey.encodeSEC1Uncompressed();\n      } catch (error) {\n        logger.error('webauthn_authentication_public_key_encoding_error', {\n          error: error instanceof Error ? error.message : 'Unknown error',\n        });\n        return err('Invalid public key encoding', {\n          field: 'publicKey',\n          code: WebAuthnErrorCode.INVALID_KEY_FORMAT,\n        });\n      }\n\n      const messageHash = sha256(signatureMessage);\n\n      // WebAuthn signatures are DER-encoded, we need to decode them first\n      const signature = decodePKIXECDSASignature(signatureBytes);\n      const isValid = verifyECDSASignature(publicKey, messageHash, signature);\n\n      if (!isValid) {\n        return err('Invalid signature', {\n          field: 'signature',\n          code: WebAuthnErrorCode.SIGNATURE_FAILED,\n        });\n      }\n    } catch (error) {\n      logger.error('webauthn_authentication_signature_verification_error', {\n        error: error instanceof Error ? error.message : 'Unknown error',\n        credentialId: credential.id,\n      });\n      return err(\n        'Signature verification failed',\n        {\n          field: 'signature',\n          code: WebAuthnErrorCode.SIGNATURE_FAILED,\n        },\n        { status: 500 }\n      ); // System error - crypto operation failed\n    }\n\n    return {\n      verified: true,\n      newCounter: authenticatorData.signatureCounter,\n    };\n  } catch (error) {\n    logger.error('webauthn_authentication_error', {\n      error: error instanceof Error ? error.message : 'Unknown error',\n    });\n    return err('Authentication verification failed', { field: 'general' }, { status: 500 });\n  }\n}\n","import { Button, Card, Input, Link, Spinner, SvgIcon } from '@ycore/componentry/vibrant';\nimport { formErrors, isError } from '@ycore/forge/result';\nimport { FormError, FormField, SecureForm, SecureProvider } from '@ycore/foundry/secure';\nimport clsx from 'clsx';\nimport * as React from 'react';\nimport { useActionData, useLoaderData, useNavigation, useSubmit } from 'react-router';\nimport type { SignInFormProps, SignInPageProps } from '../@types/auth.component.types';\nimport { createAuthenticationOptions } from '../server/webauthn';\nimport { isPlatformAuthenticatorAvailable, isWebAuthnSupported, startAuthentication } from './webauthn-client';\n\nexport function SignInForm({ signupUrl, recoverUrl }: SignInFormProps): React.JSX.Element {\n  const navigation = useNavigation();\n  const submit = useSubmit();\n  const actionData = useActionData<any>();\n  const loaderData = useLoaderData<any>();\n  const isSubmitting = navigation.state === 'submitting';\n  const errors = isError(actionData) ? formErrors(actionData) : {};\n  const [webAuthnSupported, setWebAuthnSupported] = React.useState(false);\n  const [webAuthnError, setWebAuthnError] = React.useState<string | null>(null);\n  const [isAuthenticating, setIsAuthenticating] = React.useState(false);\n  const [platformAuthAvailable, setPlatformAuthAvailable] = React.useState(false);\n  const abortControllerRef = React.useRef<AbortController | null>(null);\n\n  React.useEffect(() => {\n    const checkWebAuthn = async () => {\n      const supported = isWebAuthnSupported();\n      setWebAuthnSupported(supported);\n\n      if (supported) {\n        // Check if platform authenticator is available\n        const isPlatformAvailable = await isPlatformAuthenticatorAvailable();\n        setPlatformAuthAvailable(isPlatformAvailable);\n      }\n    };\n\n    checkWebAuthn();\n  }, []);\n\n  React.useEffect(() => {\n    // Cleanup on unmount\n    return () => {\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n      }\n    };\n  }, []);\n\n  // Reset authentication state on error\n  React.useEffect(() => {\n    if (isError(actionData)) {\n      setIsAuthenticating(false);\n      setWebAuthnError(null);\n    }\n  }, [actionData]);\n\n  const handleSubmit = async (event: React.FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    setWebAuthnError(null);\n\n    const form = event.currentTarget;\n    const formData = new FormData(form);\n    const email = formData.get('email')?.toString();\n\n    if (!email) {\n      setWebAuthnError('Email is required');\n      return;\n    }\n\n    if (!webAuthnSupported) {\n      setWebAuthnError('WebAuthn is not supported on this device');\n      return;\n    }\n\n    if (!loaderData?.challenge) {\n      setWebAuthnError('Session expired. Please refresh the page.');\n      return;\n    }\n\n    try {\n      setIsAuthenticating(true);\n      setWebAuthnError(null);\n\n      // Create AbortController for this operation\n      abortControllerRef.current = new AbortController();\n\n      // Create authentication options\n      const options = createAuthenticationOptions(\n        window.location.hostname,\n        loaderData.challenge,\n        [] // Will be populated server-side in the future\n      );\n\n      // Create timeout promise\n      const timeoutPromise = new Promise<never>((_, reject) => {\n        const timeoutId = setTimeout(() => {\n          reject(new Error('Authentication timed out. Please try again.'));\n        }, 60000);\n\n        // Clear timeout if aborted\n        abortControllerRef.current?.signal.addEventListener('abort', () => {\n          clearTimeout(timeoutId);\n        });\n      });\n\n      // Race between WebAuthn authentication and timeout\n      const credential = await Promise.race([startAuthentication(options), timeoutPromise]);\n\n      // Check if still mounted and not aborted\n      if (abortControllerRef.current?.signal.aborted) {\n        return;\n      }\n\n      // Create new FormData with WebAuthn response\n      const submitFormData = new FormData(form);\n      submitFormData.append('webauthn_response', JSON.stringify(credential));\n      submitFormData.append('intent', 'signin');\n\n      // Submit using React Router's submit function\n      submit(submitFormData, { method: 'post' });\n    } catch (error) {\n      // Check if component is still mounted and operation wasn't aborted\n      if (abortControllerRef.current?.signal.aborted) {\n        return;\n      }\n\n      setIsAuthenticating(false);\n\n      // Provide more specific error messages\n      let errorMessage = 'Authentication failed';\n      if (error instanceof Error) {\n        if (error.message.includes('cancelled')) {\n          errorMessage = 'Authentication was cancelled. Please try again when ready.';\n        } else if (error.message.includes('timed out')) {\n          errorMessage = error.message; // Use the timeout message directly\n        } else if (error.message.includes('not found')) {\n          errorMessage = 'No authenticator found for this account. Please sign up first.';\n        } else {\n          errorMessage = error.message;\n        }\n      }\n      setWebAuthnError(errorMessage);\n    }\n  };\n\n  return (\n    <SecureForm method=\"post\" onSubmit={handleSubmit} className=\"flex flex-col gap-6\">\n      <FormField label=\"Email\" error={errors.email}>\n        <Input name=\"email\" type=\"email\" placeholder=\"Enter your email\" autoComplete=\"email webauthn\" required autoFocus />\n      </FormField>\n\n      {(errors.form || webAuthnError) && <FormError error={errors.form || webAuthnError} />}\n\n      {/* Authentication in progress indicator */}\n      {isAuthenticating && (\n        <div className=\"rounded-lg border border-blue-200 bg-blue-50 p-3 text-blue-700 text-sm\">\n          <div className=\"flex items-center gap-2\">\n            <Spinner className=\"size-4\" />\n            <span>Please interact with your authenticator...</span>\n          </div>\n          <p className=\"mt-1 text-xs\">Touch your security key or approve the prompt on your device.</p>\n        </div>\n      )}\n\n      <div className=\"flex justify-between gap-x-2\">\n        <Button type=\"submit\" name=\"intent\" value=\"signin\" disabled={isSubmitting || isAuthenticating || !webAuthnSupported} className=\"flex-1\">\n          <Spinner className={clsx('size-5', !(isSubmitting || isAuthenticating) && 'hidden')} />\n          {isSubmitting || isAuthenticating ? 'Authenticating...' : !webAuthnSupported ? 'WebAuthn unsupported' : 'Passkey Sign in'}\n        </Button>\n\n        <Button type=\"button\" variant=\"outline\" asChild disabled={isSubmitting || isAuthenticating}>\n          <Link href={signupUrl}>Sign Up</Link>\n        </Button>\n      </div>\n\n      {/* WebAuthn status indicator */}\n      {webAuthnSupported && (\n        <div className=\"flex justify-between text-muted-foreground text-xs\">\n          {platformAuthAvailable ? (\n            <span className=\"flex items-center gap-2\">\n              <SvgIcon iconId=\"CircleCheck\" className=\"h-4 w-4 text-green-500\" />\n              Platform authenticator available\n            </span>\n          ) : (\n            <span className=\"flex items-center gap-2\">\n              <SvgIcon iconId=\"CircleAlert\" className=\"h-4 w-4 text-yellow-500\" />\n              External security key required\n            </span>\n          )}\n          <Button variant=\"outline\" asChild>\n            <Link href={recoverUrl}>Recover access</Link>\n          </Button>\n        </div>\n      )}\n    </SecureForm>\n  );\n}\n\nexport function SignInPage({ children, title = 'Sign In', description = 'Sign in to your account with your passkey' }: SignInPageProps): React.JSX.Element {\n  const loaderData = useLoaderData<any>();\n  const token = isError(loaderData) ? '' : (loaderData?.token ?? '');\n\n  return (\n    <SecureProvider token={token}>\n      <div className=\"mx-auto min-w-md max-w-lg px-4 py-8\">\n        <Card>\n          <Card.Header>\n            <Card.Title>{title}</Card.Title>\n            <Card.Description>{description}</Card.Description>\n          </Card.Header>\n          <Card.Content>{children}</Card.Content>\n        </Card>\n      </div>\n    </SecureProvider>\n  );\n}\n","import { Button, Card, Input, Link, Spinner, SvgIcon } from '@ycore/componentry/vibrant';\nimport { formErrors, isError } from '@ycore/forge/result';\nimport { FormError, FormField, SecureForm, SecureProvider } from '@ycore/foundry/secure';\nimport clsx from 'clsx';\nimport * as React from 'react';\nimport { useActionData, useLoaderData, useNavigation, useSubmit } from 'react-router';\nimport type { SignUpFormProps, SignUpPageProps } from '../@types/auth.component.types';\nimport { createRegistrationOptions } from '../server/webauthn';\nimport { isPlatformAuthenticatorAvailable, isWebAuthnSupported, startRegistration } from './webauthn-client';\n\nexport function SignUpForm({ signinUrl, recoverUrl }: SignUpFormProps): React.JSX.Element {\n  const navigation = useNavigation();\n  const submit = useSubmit();\n  const actionData = useActionData<any>();\n  const loaderData = useLoaderData<any>();\n  const isSubmitting = navigation.state === 'submitting';\n  const errors = isError(actionData) ? formErrors(actionData) : {};\n  const [webAuthnSupported, setWebAuthnSupported] = React.useState(false);\n  const [webAuthnError, setWebAuthnError] = React.useState<string | null>(null);\n  const [isRegistering, setIsRegistering] = React.useState(false);\n  const [platformAuthAvailable, setPlatformAuthAvailable] = React.useState(false);\n  const abortControllerRef = React.useRef<AbortController | null>(null);\n\n  React.useEffect(() => {\n    const checkWebAuthn = async () => {\n      const supported = isWebAuthnSupported();\n      setWebAuthnSupported(supported);\n\n      if (supported) {\n        // Check if platform authenticator is available\n        const isPlatformAvailable = await isPlatformAuthenticatorAvailable();\n        setPlatformAuthAvailable(isPlatformAvailable);\n      }\n    };\n\n    checkWebAuthn();\n  }, []);\n\n  React.useEffect(() => {\n    // Cleanup on unmount\n    return () => {\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n      }\n    };\n  }, []);\n\n  // Reset registration state on error\n  React.useEffect(() => {\n    if (isError(actionData)) {\n      setIsRegistering(false);\n      setWebAuthnError(null);\n    }\n  }, [actionData]);\n\n  const handleSubmit = async (event: React.FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    setWebAuthnError(null);\n\n    const form = event.currentTarget;\n    const formData = new FormData(form);\n    const email = formData.get('email')?.toString();\n    const displayName = formData.get('displayName')?.toString();\n\n    if (!email || !displayName) {\n      setWebAuthnError('Email and display name are required');\n      return;\n    }\n\n    if (!webAuthnSupported) {\n      setWebAuthnError('WebAuthn is not supported on this device');\n      return;\n    }\n\n    if (!loaderData?.challenge) {\n      setWebAuthnError('Session expired. Please refresh the page.');\n      return;\n    }\n\n    try {\n      setIsRegistering(true);\n      setWebAuthnError(null);\n\n      // Create AbortController for this operation\n      abortControllerRef.current = new AbortController();\n\n      // Create registration options\n      const options = createRegistrationOptions(\n        window.location.hostname,\n        window.location.hostname,\n        email,\n        displayName,\n        loaderData.challenge,\n        [] // Exclude credentials (none for new users)\n      );\n\n      // Create timeout promise\n      const timeoutPromise = new Promise<never>((_, reject) => {\n        const timeoutId = setTimeout(() => {\n          reject(new Error('Registration timed out. Please try again.'));\n        }, 60000);\n\n        // Clear timeout if aborted\n        abortControllerRef.current?.signal.addEventListener('abort', () => {\n          clearTimeout(timeoutId);\n        });\n      });\n\n      // Race between WebAuthn registration and timeout\n      const credential = await Promise.race([startRegistration(options), timeoutPromise]);\n\n      // Check if still mounted and not aborted\n      if (abortControllerRef.current?.signal.aborted) {\n        return;\n      }\n\n      // Create new FormData with WebAuthn response\n      const submitFormData = new FormData(form);\n      submitFormData.append('webauthn_response', JSON.stringify(credential));\n      submitFormData.append('intent', 'signup');\n\n      // Submit using React Router's submit function\n      submit(submitFormData, { method: 'post' });\n    } catch (error) {\n      // Check if component is still mounted and operation wasn't aborted\n      if (abortControllerRef.current?.signal.aborted) {\n        return;\n      }\n\n      setIsRegistering(false);\n\n      // Provide more specific error messages\n      let errorMessage = 'Registration failed';\n      if (error instanceof Error) {\n        if (error.message.includes('cancelled')) {\n          errorMessage = 'Registration was cancelled. Please try again when ready.';\n        } else if (error.message.includes('timed out')) {\n          errorMessage = error.message; // Use the timeout message directly\n        } else if (error.message.includes('already registered')) {\n          errorMessage = 'This authenticator is already registered. Please sign in instead.';\n        } else {\n          errorMessage = error.message;\n        }\n      }\n      setWebAuthnError(errorMessage);\n    }\n  };\n\n  return (\n    <SecureForm method=\"post\" onSubmit={handleSubmit} className=\"flex flex-col gap-6\">\n      <FormField label=\"Email\" error={errors.email}>\n        <Input name=\"email\" type=\"email\" placeholder=\"Enter your email\" autoComplete=\"email webauthn\" required autoFocus />\n      </FormField>\n\n      <FormField label=\"Display Name\" error={errors.displayName}>\n        <Input name=\"displayName\" type=\"text\" placeholder=\"Enter your display name\" autoComplete=\"name\" required />\n      </FormField>\n\n      {(errors.form || webAuthnError) && <FormError error={errors.form || webAuthnError} />}\n\n      {/* Registration in progress indicator */}\n      {isRegistering && (\n        <div className=\"rounded-lg border border-blue-200 bg-blue-50 p-3 text-blue-700 text-sm\">\n          <div className=\"flex items-center gap-2\">\n            <Spinner className=\"size-4\" />\n            <span>Please set up your authenticator...</span>\n          </div>\n          <p className=\"mt-1 text-xs\">Follow the prompts to create a passkey on your device.</p>\n        </div>\n      )}\n\n      <div className=\"flex items-end justify-between gap-x-2\">\n        <Button type=\"submit\" name=\"intent\" value=\"signup\" disabled={isSubmitting || isRegistering || !webAuthnSupported} className=\"flex-1\">\n          <Spinner className={clsx('size-5', !(isSubmitting || isRegistering) && 'hidden')} />\n          {isSubmitting || isRegistering ? 'Creating account...' : !webAuthnSupported ? 'WebAuthn unsupported' : 'Passkey Sign up'}\n        </Button>\n\n        <Button type=\"button\" variant=\"outline\" asChild disabled={isSubmitting || isRegistering}>\n          <Link href={signinUrl}>Sign In</Link>\n        </Button>\n      </div>\n\n      {/* WebAuthn status indicator */}\n      {webAuthnSupported && (\n        <div className=\"flex justify-between text-muted-foreground text-xs\">\n          {platformAuthAvailable ? (\n            <span className=\"flex items-center gap-2\">\n              <SvgIcon iconId=\"CircleCheck\" className=\"h-4 w-4 text-green-500\" />\n              Platform authenticator available\n            </span>\n          ) : (\n            <span className=\"flex items-center gap-2\">\n              <SvgIcon iconId=\"CircleAlert\" className=\"h-4 w-4 text-yellow-500\" />\n              External security key required\n            </span>\n          )}\n          <Button variant=\"outline\" asChild>\n            <Link href={recoverUrl}>Recover access</Link>\n          </Button>\n        </div>\n      )}\n    </SecureForm>\n  );\n}\n\nexport function SignUpPage({ children, title = 'Create Account', description = 'Sign up for a new account with your passkey' }: SignUpPageProps): React.JSX.Element {\n  const loaderData = useLoaderData<any>();\n  const token = isError(loaderData) ? '' : (loaderData?.token ?? '');\n\n  return (\n    <SecureProvider token={token}>\n      <div className=\"mx-auto min-w-md max-w-lg px-4 py-8\">\n        <Card>\n          <Card.Header>\n            <Card.Title>{title}</Card.Title>\n            <Card.Description>{description}</Card.Description>\n          </Card.Header>\n          <Card.Content>{children}</Card.Content>\n        </Card>\n      </div>\n    </SecureProvider>\n  );\n}\n","import { Button, Input, InputOtp } from '@ycore/componentry/vibrant';\nimport { formErrors, isError } from '@ycore/forge/result';\nimport { SecureForm } from '@ycore/foundry/secure';\nimport { useEffect, useState } from 'react';\nimport type { VerificationPurpose } from '../server/totp-service';\n\nexport interface VerifyFormProps {\n  email: string;\n  purpose?: VerificationPurpose;\n  resendCooldown?: number;\n  period?: number;\n  digits?: number;\n  actionData?: unknown;\n}\n\nexport function VerifyForm({ email, purpose = 'signup', resendCooldown: initialCooldown = 60, period = 480, digits = 6, actionData }: VerifyFormProps): React.JSX.Element {\n  const [code, setCode] = useState('');\n  const [resendCooldown, setResendCooldown] = useState(0);\n\n  const errors = actionData && isError(actionData) ? formErrors(actionData) : {};\n\n  // Auto-start cooldown when form loads (page just loaded after resend)\n  useEffect(() => {\n    // Check if we just did a resend (actionData exists, not an error, and has resent flag)\n    if (actionData && !isError(actionData) && typeof actionData === 'object' && 'resent' in actionData && actionData.resent) {\n      setResendCooldown(initialCooldown);\n    }\n  }, [actionData, initialCooldown]);\n\n  // Cooldown timer\n  useEffect(() => {\n    if (resendCooldown <= 0) return;\n\n    const interval = setInterval(() => {\n      setResendCooldown(prev => {\n        if (prev <= 1) {\n          clearInterval(interval);\n          return 0;\n        }\n        return prev - 1;\n      });\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, [resendCooldown]);\n\n  const purposeLabels: Record<VerificationPurpose, string> = {\n    signup: 'Email Verification',\n    'passkey-add': 'Confirm Adding Passkey',\n    'passkey-delete': 'Confirm Removing Passkey',\n    'email-change': 'Verify New Email',\n    'account-delete': 'Confirm Account Deletion',\n    recovery: 'Recover Account',\n  };\n\n  return (\n    <div className=\"mx-auto w-full max-w-md space-y-6\">\n      <div className=\"space-y-2 text-center\">\n        <h1 className=\"font-bold text-3xl tracking-tight\">{purposeLabels[purpose]}</h1>\n        <p className=\"text-muted-foreground\">\n          {digits}-digit verification code for <strong className=\"text-nowrap\">{email}</strong>\n        </p>\n      </div>\n\n      <SecureForm method=\"post\" className=\"space-y-4\" errors={errors}>\n        <Input type=\"hidden\" name=\"email\" value={email} />\n        <Input type=\"hidden\" name=\"purpose\" value={purpose} />\n\n        <SecureForm.Field label=\"Verification Code\" name=\"code\" error={errors.code} className=\"flex flex-col items-center\">\n          <InputOtp value={code} onValueChange={setCode} autoComplete=\"one-time-code\" validationType=\"numeric\" disabled={false}>\n            <InputOtp.Group>\n              {Array.from({ length: digits }).map((_, index) => (\n                // biome-ignore lint/suspicious/noArrayIndexKey: acceptable\n                <InputOtp.Slot key={index} index={index} />\n              ))}\n            </InputOtp.Group>\n            <InputOtp.HiddenInput name=\"code\" />\n          </InputOtp>\n        </SecureForm.Field>\n\n        <div className=\"space-y-3\">\n          <div className=\"flex justify-around\">\n            <Button type=\"submit\" name=\"intent\" value=\"resend\" variant={code.length !== digits ? 'default' : 'outline'} disabled={resendCooldown > 0} formNoValidate>\n              {resendCooldown > 0 ? `Resend in ${resendCooldown}s` : 'Resend Code'}\n            </Button>\n\n            <Button type=\"submit\" name=\"intent\" value=\"verify\" variant={code.length !== digits ? 'outline' : 'default'} disabled={code.length !== digits}>\n              Verify Code\n            </Button>\n          </div>\n          <div className=\"flex justify-center\">\n            <Button type=\"submit\" name=\"intent\" value=\"unverify\" variant=\"destructive\" formNoValidate>\n              Unverify Email\n            </Button>\n          </div>\n        </div>\n\n        <p className=\"text-center text-muted-foreground text-sm\">The code expires within {Math.floor(period / 60)} minutes</p>\n      </SecureForm>\n    </div>\n  );\n}\n","import type { TailwindStylesMap } from '@ycore/componentry/email/server';\nimport type { JSXElementConstructor, ReactElement } from 'react';\n\n/**\n * Email Template Definition\n *\n * Type-safe structure for defining email templates with component, subject, and styles map\n */\nexport interface EmailTemplateDefinition<TData> {\n  component: (props: TData) => ReactElement<unknown, string | JSXElementConstructor<unknown>>;\n  subject: (data: TData) => string;\n  stylesMap?: TailwindStylesMap;\n}\n\n/**\n * Email Template Object\n *\n * Returned by defineEmailTemplate with helper methods\n */\nexport interface EmailTemplateObject<TData> {\n  component: (props: TData) => ReactElement<unknown, string | JSXElementConstructor<unknown>>;\n  subject: (data: TData) => string;\n  stylesMap?: TailwindStylesMap;\n  render: (data: TData) => {\n    component: ReactElement<unknown, string | JSXElementConstructor<unknown>>;\n    subject: string;\n    stylesMap?: TailwindStylesMap;\n  };\n}\n\n/**\n * Define Email Template\n *\n * Type-safe helper for creating unified email templates\n *\n * @example\n * ```typescript\n * export const ContactTemplate = defineEmailTemplate({\n *   component: ({ name, email }) => <Html>...</Html>,\n *   subject: ({ name }) => `Contact from ${name}`,\n *   stylesMap: TEMPLATE_TAILWIND_MAP,\n * });\n * ```\n */\nexport function defineEmailTemplate<TData>({ component, subject, stylesMap }: EmailTemplateDefinition<TData>): EmailTemplateObject<TData> {\n  return {\n    component,\n    subject,\n    stylesMap,\n    // Helper method for type-safe rendering\n    render: (data: TData) => ({\n      component: component(data),\n      subject: subject(data),\n      stylesMap,\n    }),\n  };\n}\n","/**\n * ⚠️  DO NOT EDIT THIS FILE MANUALLY\n * Auto-generated Tailwind CSS utility styles map for email components at: 2025-11-03T16:38:05.877Z\n *\n *   - Template files scanned: 4\n *   - Unique classes found: 37\n *   - Static styles mapped: 36\n *   - Dynamic patterns: 2\n */\n\nimport type { TailwindStylesMap } from '@ycore/componentry/email/server';\nimport type { CSSProperties } from 'react';\n\nexport const TAILWIND_TO_CSS_MAP: Record<string, Partial<CSSProperties>> = {\n  'm-0': {\"margin\":\"0rem\"},\n  'm-3': {\"margin\":\"0.75rem\"},\n  'm-4': {\"margin\":\"1rem\"},\n  'm-5': {\"margin\":\"1.25rem\"},\n  'mx-2': {\"marginInline\":\"0.5rem\"},\n  'mx-5': {\"marginInline\":\"1.25rem\"},\n  'mx-auto': {\"marginInline\":\"auto\"},\n  'my-5': {\"marginBlock\":\"1.25rem\"},\n  'max-w-2xl': {\"maxWidth\":\"42rem\"},\n  'max-w-md': {\"maxWidth\":\"28rem\"},\n  'rounded-2xl': {\"borderRadius\":\"1rem\"},\n  'rounded-lg': {\"borderRadius\":\"0.625rem\"},\n  'border-2': {\"borderStyle\":\"solid\",\"borderWidth\":\"2px\"},\n  'border-border': {\"borderColor\":\"oklch(70.7% 0.022 261.325)\"},\n  'bg-muted': {\"backgroundColor\":\"oklch(87.2% 0.01 258.338)\"},\n  'bg-white': {\"backgroundColor\":\"#fff\"},\n  'p-3': {\"padding\":\"0.75rem\"},\n  'p-5': {\"padding\":\"1.25rem\"},\n  'px-5': {\"paddingInline\":\"1.25rem\"},\n  'py-5': {\"paddingBlock\":\"1.25rem\"},\n  'pt-10': {\"paddingTop\":\"2.5rem\"},\n  'pb-5': {\"paddingBottom\":\"1.25rem\"},\n  'text-center': {\"textAlign\":\"center\"},\n  'text-left': {\"textAlign\":\"left\"},\n  'font-sans': {\"fontFamily\":\"ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol',\\n    'Noto Color Emoji'\"},\n  'text-3xl': {\"fontSize\":\"1.875rem\",\"lineHeight\":\"var(--text-3xl--line-height)\"},\n  'text-sm': {\"fontSize\":\"0.875rem\",\"lineHeight\":\"var(--text-sm--line-height)\"},\n  'leading-relaxed': {\"lineHeight\":\"1.625\"},\n  'font-bold': {\"fontWeight\":\"700\"},\n  'text-destructive': {\"color\":\"oklch(50.5% 0.213 27.518)\"},\n  'text-foreground': {\"color\":\"oklch(27.8% 0.033 256.848)\"},\n  'text-muted-foreground': {\"color\":\"oklch(55.1% 0.027 264.364)\"},\n  'italic': {\"fontStyle\":\"italic\"},\n  'no-underline': {\"textDecorationLine\":\"none\"},\n  'underline': {\"textDecorationLine\":\"underline\"},\n  'dark': {\"color\":\"color-mix(in lab, red, red)) {\\n    & {\\n      --border: color-mix(in oklab, oklch(96.7% 0.003 264.542) 10%, transparent)\"},\n};\n\nexport const DYNAMIC_UTILITY_PATTERNS = [\n  {\n    regex: /^text-\\[(.+?)\\]$/,\n    converter: (matches: RegExpMatchArray) => ({ fontSize: matches[1] }),\n  },\n  {\n    regex: /^tracking-\\[(.+?)\\]$/,\n    converter: (matches: RegExpMatchArray) => ({ letterSpacing: matches[1] }),\n  },\n];\n\nexport const TEMPLATE_STYLES_MAP: TailwindStylesMap = {\n  cssMap: TAILWIND_TO_CSS_MAP,\n  dynamicPatterns: DYNAMIC_UTILITY_PATTERNS,\n};\n","import { Body, Container, Head, Heading, Html, Section, Text } from '@ycore/componentry/email';\nimport { defineEmailTemplate } from '../../email/@types/email-template-builder';\nimport { TEMPLATE_STYLES_MAP } from './tailwind.styles';\n\nexport type VerificationPurpose = 'signup' | 'passkey-add' | 'passkey-delete' | 'email-change' | 'account-delete' | 'recovery';\n\nexport interface TotpTemplateData {\n  code: string;\n  purpose: VerificationPurpose;\n}\n\n/**\n * TOTP content structure for each verification purpose\n */\nexport interface TotpContent {\n  title: string;\n  message: string;\n  action: string;\n}\n\n/**\n * Type-safe repository mapping all verification purposes to their content\n * TypeScript will error if any VerificationPurpose is missing or extra keys exist\n */\nexport type TotpRepository = Record<VerificationPurpose, TotpContent>;\n\n/**\n * Repository of TOTP email content for each verification purpose\n * Indexed by VerificationPurpose for type-safe lookups\n */\nexport const totpRepository = {\n  signup: {\n    title: 'Verify Email Address',\n    message: 'Thank you for signing up. Please verify the email address to complete the sign-up.',\n    action: 'verify your email',\n  },\n  'passkey-add': {\n    title: 'Confirm Adding Passkey',\n    message: 'Please verify adding a new passkey to the user account.',\n    action: 'confirm adding the passkey',\n  },\n  'passkey-delete': {\n    title: 'Confirm Removing Passkey',\n    message: 'Please verify removing a passkey from the user account.',\n    action: 'confirm removing the passkey',\n  },\n  'email-change': {\n    title: 'Verify Email Address Update',\n    message: 'Please verify the email address change.',\n    action: 'verify email address change',\n  },\n  'account-delete': {\n    title: 'Confirm Account Deletion',\n    message: 'Please confirm account delete. This action cannot be undone.',\n    action: 'confirm account deletion',\n  },\n  recovery: {\n    title: 'Confirm Account Recovery',\n    message: 'An account recovery request is pending. Use this code to regain access to the account.',\n    action: 'recover your account',\n  },\n} as const satisfies TotpRepository;\n\n/**\n * TOTP Email Template\n * Email template for TOTP verification codes with purpose-specific content\n */\nexport const TotpEmailTemplate = defineEmailTemplate({\n  component: ({ code, purpose }: TotpTemplateData) => {\n    const content = totpRepository[purpose];\n    const isHighRisk = purpose === 'account-delete' || purpose === 'passkey-delete';\n    const isAccountDelete = purpose === 'account-delete';\n\n    return (\n      <Html lang=\"en\">\n        <Head />\n        <Body className=\"bg-white font-sans\">\n          <Container className={`mx-auto max-w-2xl text-foreground leading-relaxed ${isAccountDelete ? 'rounded-lg border-2 border-warning-200 bg-warning-100 p-5' : ''}`}>\n            <Section className=\"px-5 pt-10 pb-5 text-center\">\n              <Heading level={1}>{content.title}</Heading>\n            </Section>\n\n            <Section className=\"px-5 pb-5 text-center text-muted-foreground\">\n              <Text>{content.message}</Text>\n            </Section>\n\n            <Section className=\"mx-5 my-5 rounded-lg border-2 border-border bg-muted p-5 text-center\">\n              <Text className=\"m-0 font-bold text-3xl text-foreground tracking-[8px]\">{code}</Text>\n            </Section>\n\n            <Section className=\"px-5 py-5 text-center text-muted-foreground text-sm\">\n              <Text>\n                This code will expire within <strong>8 minutes</strong> of issuing.\n              </Text>\n              <Text>If this code was not requested,{isHighRisk ? ' consider securing your account' : ' it can be safely ignored'}.</Text>\n            </Section>\n          </Container>\n        </Body>\n      </Html>\n    );\n  },\n\n  subject: ({ purpose }) => totpRepository[purpose].title,\n\n  stylesMap: TEMPLATE_STYLES_MAP,\n});\n","import { Body, Container, Head, Heading, Html, Section, Text } from '@ycore/componentry/email';\nimport { defineEmailTemplate } from '../../email/@types/email-template-builder';\nimport { TEMPLATE_STYLES_MAP } from './tailwind.styles';\n\nexport interface EmailChangeNotificationData {\n  oldEmail: string;\n  newEmail: string;\n}\n\n/**\n * Email Change Notification Template\n * Sent to the old email address to inform about email change request\n * This is an informational notification, not a verification email\n */\nexport const EmailChangeNotificationTemplate = defineEmailTemplate({\n  component: ({ oldEmail, newEmail }: EmailChangeNotificationData) => (\n    <Html lang=\"en\">\n      <Head />\n      <Body className=\"bg-white font-sans\">\n        <Container className=\"mx-auto max-w-2xl text-foreground leading-relaxed\">\n          <Section className=\"m-5 text-center\">\n            <Heading level={1}>Important security notification</Heading>\n          </Section>\n\n          <Section className=\"m-5 rounded-lg border-2 border-border bg-muted p-5 text-center\">\n            <Text>\n              A request was received to change the account access email from <strong>{oldEmail}</strong> to <strong>{newEmail}</strong>, and is pending approval.\n            </Text>\n            <Text>\n              A verification code was sent to <strong>{newEmail}</strong>.\n            </Text>\n            <Text>The account email will only be changed once the new address is successfully verified.</Text>\n          </Section>\n\n          <Section className=\"m-4 text-center text-muted-foreground text-sm\">\n            <Text>If the email change was not requested, consider that someone may have unauthorized access to the account. It may be necessary to secure the account.</Text>\n            <Heading level={3} className=\"text-destructive\">\n              If unauthorized, take immediate action:\n            </Heading>\n            <Section className=\"mx-auto max-w-md text-left\">\n              <Text className=\"italic\">• Sign in to the account at {oldEmail}</Text>\n              <Text className=\"italic\">• Review the security settings and passkeys</Text>\n              <Text className=\"italic\">• Remove any unfamiliar devices</Text>\n            </Section>\n          </Section>\n        </Container>\n      </Body>\n    </Html>\n  ),\n\n  subject: () => 'Important Security Notification - Email Change Request',\n\n  stylesMap: TEMPLATE_STYLES_MAP,\n});\n","import { Body, Container, Head, Heading, Html, Link, Section, Text } from '@ycore/componentry/email';\nimport { defineEmailTemplate } from '../../email/@types/email-template-builder';\nimport { TEMPLATE_STYLES_MAP } from './tailwind.styles';\n\nexport interface EmailChangeVerificationData {\n  code: string;\n  oldEmail: string;\n  newEmail: string;\n  verificationUrl?: string;\n}\n\n/**\n * Email Change Verification Template\n * Sent to the NEW email address with verification code and email change context\n * Combines notification + verification in a single email\n */\nexport const EmailChangeVerificationTemplate = defineEmailTemplate({\n  component: ({ code, oldEmail, newEmail, verificationUrl }: EmailChangeVerificationData) => (\n    <Html lang=\"en\">\n      <Head />\n      <Body className=\"bg-white font-sans\">\n        <Container className=\"mx-auto max-w-2xl text-foreground leading-relaxed\">\n          <Section className=\"px-5 pt-10 pb-5 text-center\">\n            <Heading level={1}>Email Address Change Verification</Heading>\n          </Section>\n\n          <Section className=\"m-5 rounded-lg border-2 border-border bg-muted p-5 text-center\">\n            <Text>\n              An account email address change from <strong>{oldEmail}</strong> to <strong>{newEmail}</strong> is pending.\n            </Text>\n            <Text>Please approve the email address change using the code below.</Text>\n          </Section>\n\n          <Section className=\"m-5 rounded-lg border-2 border-border bg-muted p-5 text-center\">\n            <Text className=\"m-0 font-bold text-[32px] text-foreground tracking-[8px]\">{code}</Text>\n          </Section>\n\n          <Section className=\"m-3 text-center text-muted-foreground text-sm\">\n            <Text>\n              This code will expire within <strong>8 minutes</strong> if not approved.\n            </Text>\n          </Section>\n\n          {verificationUrl && (\n            <Section className=\"m-4 rounded-2xl bg-muted p-3 text-center\">\n              <Text className=\"mx-2\">\n                <Link href={verificationUrl} className=\"font-bold no-underline\">\n                  Click this link to approve the change\n                </Link>\n              </Text>\n\n              <Text className=\"mx-2\">\n                <Text>If having trouble using the link above, use the url below to verify.</Text>\n                <Link href={verificationUrl} className=\"underline\">\n                  {verificationUrl}\n                </Link>\n              </Text>\n            </Section>\n          )}\n\n          <Section className=\"m-4 text-center text-muted-foreground text-sm\">\n            <Text>If this code was not requested, consider that someone may have unauthorized access to the account. It may be necessary to secure the account.</Text>\n            <Heading level={3} className=\"text-destructive\">\n              If unauthorized, take immediate action:\n            </Heading>\n            <Section className=\"mx-auto max-w-md text-left\">\n              <Text className=\"italic\">\n                • <strong>Do not enter the verification code.</strong>\n              </Text>\n              <Text className=\"italic\">• Sign in to the account at {oldEmail}</Text>\n              <Text className=\"italic\">• Review the security settings and passkeys</Text>\n              <Text className=\"italic\">• Remove any unfamiliar devices</Text>\n            </Section>\n          </Section>\n        </Container>\n      </Body>\n    </Html>\n  ),\n\n  subject: () => 'Email Address Change Verification',\n\n  stylesMap: TEMPLATE_STYLES_MAP,\n});\n","import { Body, Container, Head, Heading, Html, Link, Section, Text } from '@ycore/componentry/email';\nimport { defineEmailTemplate } from '../../email/@types/email-template-builder';\nimport { TEMPLATE_STYLES_MAP } from './tailwind.styles';\n\nexport interface RecoveryVerificationData {\n  code: string;\n  email: string;\n  verificationUrl?: string;\n}\n\n/**\n * Account Recovery Verification Template\n * Sent when user requests account recovery (lost passkey access)\n * Combines security notification + verification code in a single email\n */\nexport const RecoveryVerificationTemplate = defineEmailTemplate({\n  component: ({ code, email, verificationUrl }: RecoveryVerificationData) => (\n    <Html lang=\"en\">\n      <Head />\n      <Body className=\"bg-white font-sans\">\n        <Container className=\"mx-auto max-w-2xl text-foreground leading-relaxed\">\n          <Section className=\"px-5 pt-10 pb-5 text-center\">\n            <Heading level={1}>Account Recovery Request</Heading>\n          </Section>\n\n          <Section className=\"m-5 rounded-lg border-2 border-border bg-muted p-5 text-center\">\n            <Text>\n              An account recovery request for <strong>{email}</strong> is pending approval.\n            </Text>\n            <Text>If approved, registration of a new passkey will be allowed to proceed.</Text>\n            <Text>Please approve the account recovery request using the code below.</Text>\n          </Section>\n\n          <Section className=\"m-5 rounded-lg border-2 border-border bg-muted p-5 text-center\">\n            <Text className=\"m-0 font-bold text-[32px] text-foreground tracking-[8px]\">{code}</Text>\n          </Section>\n\n          <Section className=\"m-3 text-center text-muted-foreground text-sm\">\n            <Text>\n              This code will expire within <strong>8 minutes</strong> if not approved.\n            </Text>\n          </Section>\n\n          {verificationUrl && (\n            <Section className=\"m-4 rounded-2xl bg-muted p-3 text-center\">\n              <Text className=\"mx-2\">\n                <Link href={verificationUrl} className=\"font-bold no-underline\">\n                  Click this link to approve the change\n                </Link>\n              </Text>\n\n              <Text className=\"mx-2\">\n                <Text>If having trouble using the link above, use the url below to verify.</Text>\n                <Link href={verificationUrl} className=\"underline\">\n                  {verificationUrl}\n                </Link>\n              </Text>\n            </Section>\n          )}\n\n          <Section className=\"m-4 text-center text-muted-foreground text-sm\">\n            <Text>If this code was not requested, consider that someone may have unauthorized access to the account. It may be necessary to secure the account.</Text>\n            <Heading level={3} className=\"text-destructive\">\n              If unauthorized, take immediate action:\n            </Heading>\n            <Section className=\"mx-auto max-w-md text-left\">\n              <Text className=\"italic\">\n                • <strong>Do not enter the verification code.</strong>\n              </Text>\n              <Text className=\"italic\">• Sign in to the account at {email}</Text>\n              <Text className=\"italic\">• Review the security settings and passkeys</Text>\n              <Text className=\"italic\">• Remove any unfamiliar devices</Text>\n            </Section>\n          </Section>\n        </Container>\n      </Body>\n    </Html>\n  ),\n\n  subject: () => 'Account Recovery Verification',\n\n  stylesMap: TEMPLATE_STYLES_MAP,\n});\n"],"names":["Link"],"mappings":"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","x_google_ignoreList":[1]}